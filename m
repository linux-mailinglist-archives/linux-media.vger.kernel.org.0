Return-Path: <linux-media-owner@vger.kernel.org>
X-Original-To: lists+linux-media@lfdr.de
Delivered-To: lists+linux-media@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id C0D5517EDA7
	for <lists+linux-media@lfdr.de>; Tue, 10 Mar 2020 02:07:41 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726480AbgCJBHZ (ORCPT <rfc822;lists+linux-media@lfdr.de>);
        Mon, 9 Mar 2020 21:07:25 -0400
Received: from relmlor1.renesas.com ([210.160.252.171]:21605 "EHLO
        relmlie5.idc.renesas.com" rhost-flags-OK-OK-OK-FAIL)
        by vger.kernel.org with ESMTP id S1726466AbgCJBHY (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Mon, 9 Mar 2020 21:07:24 -0400
Date:   10 Mar 2020 10:07:23 +0900
X-IronPort-AV: E=Sophos;i="5.70,535,1574089200"; 
   d="scan'208";a="41431033"
Received: from unknown (HELO relmlir5.idc.renesas.com) ([10.200.68.151])
  by relmlie5.idc.renesas.com with ESMTP; 10 Mar 2020 10:07:23 +0900
Received: from mercury.renesas.com (unknown [10.166.252.133])
        by relmlir5.idc.renesas.com (Postfix) with ESMTP id 2B391400753F;
        Tue, 10 Mar 2020 10:07:23 +0900 (JST)
Message-ID: <87a74pvwz8.wl-kuninori.morimoto.gx@renesas.com>
From:   Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
To:     Alex Riesen <alexander.riesen@cetitec.com>
Cc:     Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
        Geert Uytterhoeven <geert@linux-m68k.org>,
        Kieran Bingham <kieran.bingham@ideasonboard.com>,
        Mauro Carvalho Chehab <mchehab@kernel.org>,
        Hans Verkuil <hverkuil-cisco@xs4all.nl>,
        Rob Herring <robh+dt@kernel.org>,
        Mark Rutland <mark.rutland@arm.com>,
        Driver Development <devel@driverdev.osuosl.org>,
        Linux Media <linux-media@vger.kernel.org>,
        Linux Kernel <linux-kernel@vger.kernel.org>,
        Device Tree <devicetree@vger.kernel.org>,
        Renesas SoC <linux-renesas-soc@vger.kernel.org>
Subject: Re: [PATCH 8/8] arm64: dts: renesas: salvator: add a connection from adv748x codec (HDMI input) to the R-Car SoC
In-Reply-To: <20200309110931.GB3593@pflmari>
References: <CAMuHMdWobAE+y90DRi+zQadObWPxLyQiGNTe4t77O-2S1Vp5yA@mail.gmail.com>
        <20200302150706.GB3717@pflmari>
        <CAMuHMdW21rYXoOSE8azHNqYjng_j41rsL=Fo2bZc=1ULi9+pLw@mail.gmail.com>
        <20200302160906.GC3717@pflmari>
        <CAMuHMdVNGsVHyvAgC5dAHx=8Ax18EHx2tS6Hm5Bkg4ms=mW6Zw@mail.gmail.com>
        <20200305143628.GB25741@pflmari>
        <20200306131632.GA4878@pendragon.ideasonboard.com>
        <20200306134154.GD27714@pflmari>
        <20200306134546.GE4878@pendragon.ideasonboard.com>
        <87r1y2wbze.wl-kuninori.morimoto.gx@renesas.com>
        <20200309110931.GB3593@pflmari>
User-Agent: Wanderlust/2.15.9 Emacs/25.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-media-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-media.vger.kernel.org>
X-Mailing-List: linux-media@vger.kernel.org


Hi Alex

> Should the adv748x driver also implement anything to configure the frequency
> of MCLK clock? I mean something like .set_sysclk and .set_fmt callbacks of
> snd_soc_dai_ops?
> 
> Or is the driver implementation, which depends on mclk-fs to be 256, the audio
> stream format to be 8x S24_LE, and requires strictly 48kHz sampling rate on
> the HDMI input, a totally acceptable first attempt at writing a DAI driver?
> 
> I'm a bit bothered by that, as the hardware is also capable of decoding
> stereo, sampling rate 32-192kHz, a variety of PCM and compressed/encrypted
> formats, 128-768fs MCLK multipliers, and a row of I2S options.
> 
> I just find it confusing to place the configuration interfaces.
> For instance, the patches use the media ioctl for audio output selection to
> select I2S protocol. While works, it does not feel right (shouldn't it be in
> the device tree?)
> 
> Maybe you can point me at a driver doing something similar? I'm studying media
> drivers now, but not many of them use ASoC interfaces for devices providing a
> clock. Or maybe I should better look at sound/soc/...?

Setting Sound Clock for all cases/patterns are very complex and difficult actually.
(ADV7482 configuration) x (ADG divider / selector) x etc, etc...

Thus, Current R-Car sound is assuming that audio_clk_a/b/c/i are providing
route clock (= no configuration, fixed clock), and ADG divides it,
and provide best clock to each SSIx.

Current Salvator/ULCB already have 44.1/48kHz route clock (= CS2000 and Audio_CLK_A),
and we can reuse it for all SSIx. Thus, ADV7482 clock is not necessary, I guess ?
Or providing specific clock for some case is enough
(ADG will automatically select it if necessary).

If ADV7482 needs more detail clock settings combination,
then, there is no method to adjust to it.
We need to consider such system somehow.

Thank you for your help !!

Best regards
---
Kuninori Morimoto
