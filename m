Return-Path: <linux-media-owner@vger.kernel.org>
X-Original-To: lists+linux-media@lfdr.de
Delivered-To: lists+linux-media@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 5F93BE7C39
	for <lists+linux-media@lfdr.de>; Mon, 28 Oct 2019 23:16:29 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727238AbfJ1WQ2 (ORCPT <rfc822;lists+linux-media@lfdr.de>);
        Mon, 28 Oct 2019 18:16:28 -0400
Received: from lb2-smtp-cloud7.xs4all.net ([194.109.24.28]:43433 "EHLO
        lb2-smtp-cloud7.xs4all.net" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S1725776AbfJ1WQ2 (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Mon, 28 Oct 2019 18:16:28 -0400
Received: from [172.20.7.25] ([77.158.50.100])
        by smtp-cloud7.xs4all.net with ESMTPA
        id PDJAir1JHHfodPDJEiCzk9; Mon, 28 Oct 2019 23:16:25 +0100
Subject: Re: [ANN v2] Media sessions in Lyon in October: codecs
To:     Daniel Gomez <daniel@qtec.com>,
        Stanimir Varbanov <stanimir.varbanov@linaro.org>
Cc:     Linux Media Mailing List <linux-media@vger.kernel.org>,
        Boris Brezillon <boris.brezillon@collabora.com>,
        Alexandre Courbot <acourbot@chromium.org>,
        Nicolas Dufresne <nicolas@ndufresne.ca>,
        Tomasz Figa <tfiga@chromium.org>,
        Ezequiel Garcia <ezequiel@collabora.com>,
        Dafna Hirschfeld <dafna.hirschfeld@collabora.com>,
        Eugen Hristev <Eugen.Hristev@microchip.com>,
        Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
        Helen Koike <helen.koike@collabora.com>,
        Michael Tretter <m.tretter@pengutronix.de>,
        Jacopo Mondi <jacopo+renesas@jmondi.org>,
        Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
        Maxime Ripard <maxime.ripard@bootlin.com>,
        Dave Stevenson <dave.stevenson@raspberrypi.org>
References: <f35e5aaa-cb3d-a0ad-ebc8-ed9410eb33b1@xs4all.nl>
 <7dbe2044-aad2-22b0-9e81-0e806127db97@linaro.org>
 <CAH1Ww+Taq+po9YAwYAxHH+YdqNvszmqnsFC_NmB4fXhX3Z7SDQ@mail.gmail.com>
From:   Hans Verkuil <hverkuil@xs4all.nl>
Message-ID: <83f7ad47-e29b-ee1e-86da-f657d6ab44ce@xs4all.nl>
Date:   Mon, 28 Oct 2019 23:16:16 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <CAH1Ww+Taq+po9YAwYAxHH+YdqNvszmqnsFC_NmB4fXhX3Z7SDQ@mail.gmail.com>
Content-Type: text/plain; charset=utf-8; format=flowed
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-CMAE-Envelope: MS4wfGcEIB5th7fWqk477D+YlvNuMIqrUlUtmSY/sgN4bi6azdOIFjuO+EHdg9JuUJwUKGDxWqC8RZJ4vcdzNII4ZCfdJ/J1hXs5GCx3Lzh7n7nHYvSW7WRy
 giuNJ6JgfX/KcbGb6FlipCxc8ll33e/C02FgjQDm4mDPXsfVjb5SNEkcbXygmbvLNv+XWhEM+wpzjIgumtHcZ4hYicqMl4sTpePy1FXKwFzFkMqrV4bYXhS2
 Jg62nuHFvzOYpE/HaqTDWOoUYwgS0Wcl067jaoR6g7R7QYR104/vcPiSdGYAAlms/+8L7ktxbq9PCgPSR+WDHBf6ZLOjrfGIkR4sM4q7P+43g7YR4TCR+oiG
 R89iJobt3voS8TEEoPa1+kplWGaYT45ekLehw+x3m7Pxgs36ahHy21JwLF0TeEAU1tnqqOTFJ4tLGCBcpJE5Py5Y5JpsV1G4xLko+EB0+7cwMa/786JNWlNN
 yzWgKPKoxZ4QTHoLQYsyklnGEzZ/StLstq5EXtjKS67+Ris9Vdyf7lEZy/Tb0agczsEizDtmdi9J72DGVdVjHEq9T1Slovubf+PvLxjzD8QxxvZmNDgVVxZF
 m+Eno2Y65i4nTB0B+p6Uv1ut2nsDqlIEzIQCiS4Ead9URDJbRuW48g6pMyS3EEDBq3QT0zNm185uOfr2RLym6zTdtc7/oCyGM85PGNu2DqyLd92OvulCoVRW
 ZtY5OAUiClItTjel9xFzYnhV1+Mtzf+zX4nEQRAoqGEEdbVDVqjB5sfC04s/7IWJSHAVYdzaLQRKrhoVSnvxy+gcGngqRAxY
Sender: linux-media-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-media.vger.kernel.org>
X-Mailing-List: linux-media@vger.kernel.org

On 10/28/19 11:04 PM, Daniel Gomez wrote:
> Hi Hans,
> 
> On Mon, 28 Oct 2019 at 19:55, Stanimir Varbanov
> <stanimir.varbanov@linaro.org> wrote:
>>
>> Hi Hans,
>>
>> On 10/17/19 1:25 PM, Hans Verkuil wrote:
>>> Hi all,
>>>
>>> Since we have three separate half-day sessions for different topics I decided
>>> to split the announcement for this in three emails as well, so these things
>>> can be discussed in separate threads.
>>>
>>> All sessions are in room Terreaux VIP Lounge - Level 0.
>>> There is a maximum of 15 people.
>>>
>>> The first session deals with the codec API and is on Tuesday morning from
>>> 8:30 to 12:00 (we have to vacate the room at that time). Note that 8:30
>>> start time!
>>>
>>> Confirmed attendees for this session:
>>>
>>> Boris Brezillon <boris.brezillon@collabora.com>
>>> Alexandre Courbot <acourbot@chromium.org>
>>> Nicolas Dufresne <nicolas@ndufresne.ca>
>>> Tomasz Figa <tfiga@chromium.org>
>>> Ezequiel Garcia <ezequiel@collabora.com>
>>> Dafna Hirschfeld <dafna.hirschfeld@collabora.com>
>>> Paul Kocialkowski <paul.kocialkowski@bootlin.com>
>>> Maxime Ripard <mripard@kernel.org>
>>> Dave Stevenson <dave.stevenson@raspberrypi.org>
>>> Michael Tretter <m.tretter@pengutronix.de>
>>> Stanimir Varbanov <stanimir.varbanov@linaro.org>
>>> Hans Verkuil <hverkuil@xs4all.nl>
>>>
>>> Please let me know asap if I missed someone, or if you are listed, but
>>> can't join for some reason.
>>
>> I'll late for this session for unforeseen reasons (I stuck at Frankfurt
>> airport), please feel free to reallocate my seat for someone who
>> interested. Sorry for inconvenience.
>>
>>>
>>> There are three seats left, and I have five on the 'just interested'
>>> list:
>>>
>>> Daniel Gomez <daniel@qtec.com>
>>> Eugen Hristev <Eugen.Hristev@microchip.com>
>>> Helen Koike <helen.koike@collabora.com>
>>> Jacopo Mondi <jacopo@jmondi.org>
>>> Laurent Pinchart <laurent.pinchart@ideasonboard.com>
>>>
>>> If you still want to join, please mail me. First come, first served :-)
>>>
>>> Agenda:
>>>
>>> Note: I didn't assign start times, we'll just go through these items one-by-one.
>>>
>>> - Status of any pending patches related to codec support.
>>>    I'll provide a list of those patches by the end of next week so we
>>>    can go through them.
>>>
>>> - Requirements of moving codec drivers out of staging.
>>>
>>> - Finalize the stateful encoder API. There are two pieces that need
>>>    to be defined:
>>>
>>>    1) Setting the frame rate so bitrate control can make sense, since
>>>       they need to know this information. This is also relevant for the
>>>       stateless codec (and this may have to change on a per-frame basis
>>>       for stateless codecs!).
>>>
>>>       This can either be implemented via ENUM_FRAMEINTERVALS for the coded
>>>       pixelformats plus S_PARM support, or we just add a new control for this.
>>>       E.g. V4L2_CID_MPEG_VIDEO_FRAME_INTERVAL using struct v4l2_fract.
>>>
>>>       I am inclined to go with a control, since the semantics don't really
>>>       match ENUM_FRAMEINTERVALS/S_PARM. These ioctls still need to be supported
>>>       for legacy drivers. Open question: some drivers (mediatek, hva, coda)
>>>       require S_PARM(OUTPUT), some (venus) allow both S_PARM(CAPTURE) and
>>>       S_PARM(OUTPUT). I am inclined to allow both since this is not a CAPTURE
>>>       vs OUTPUT thing, it is global to both queues.
>>>
>>>    2) Interactions between OUTPUT and CAPTURE formats.
>>>
>>>       The main problem is what to do if the capture sizeimage is too small
>>>       for the OUTPUT resolution when streaming starts.
>>>
>>>       Proposal: width and height of S_FMT(OUTPUT) plus max-bitrate plus frame
>>>       interval plus key frame interval info are used to calculate a minimum
>>>       CAPTURE sizeimage (app may request more). This is codec-specific, I think,
>>>       so it should be possible to provide helper functions for this.
>>>
>>>       However, it may be quite difficult to make a good calculation. I just
>>>       don't know enough to determine this.
>>>
>>>       V4L2_FMT_FLAG_DYN_RESOLUTION is always cleared for codec formats
>>>       for the encoder (i.e. we don't support mid-stream resolution
>>>       changes for now) and V4L2_EVENT_SOURCE_CHANGE is not
>>>       supported.
>>>
>>>       Of course, if we start to support mid-stream resolution
>>>       changes (or other changes that require a source change event),
>>>       then this flag should be set by the encoder driver and
>>>       documentation on how to handle the source change event should
>>>       be documented in the encoder spec. I prefer to postpone this
>>>       until we have an encoder than can actually do mid-stream
>>>       resolution changes.
>>>
>>>       If sizeimage of the OUTPUT is too small for the CAPTURE
>>>       resolution and V4L2_EVENT_SOURCE_CHANGE is not supported,
>>>       then the second STREAMON (either CAPTURE or OUTPUT) will
>>>       return -ENOMEM since there is not enough memory to do the
>>>       encode.
>>>
>>>       If V4L2_FMT_FLAG_DYN_RESOLUTION is cleared (i.e. that is
>>>       the case for all current encoders), then any bitrate controls
>>>       will be limited in range to what the current state (CAPTURE and
>>>       OUTPUT formats and frame interval) supports.
>>>
>>> - Stateless encoder support
>>>
>>>    Overall goals:
>>>
>>>    - Find out if there is a common set of per frame encoding parameters
>>>    - Find out if bitrate control can be reused for multiple HW
>>>    - Decide if we do in-kernel bitrate control or not
>>>    - Decide if we keep bitstream header crafting external (unlike Hantro
>>>      JPEG encoder, but like VAAPI)
>>>    - Decide if we provide (and maintain) a libv4l2 plugin like ChromeOS
>>>      folks opted for.
>>>
>>>    I hope Nicolas and Tomasz can prepare for this.
>>>
>>>    The one requirement that Cisco would have for these devices is that
>>>    we must be able to do per-frame bitrate control from userspace.
>>>
>>> Regards,
>>>
>>>        Hans
>>>
>>
>> --
>> regards,
>> Stan
> 
> Same here, I would like to know if there is more people you plan to
> add to the attendee's list.
> If not, I would like to be there.

No problem, there is a seat left. I'll see you tomorrow!

Regards,

	Hans

> 
> Thanks,
> Daniel
> 

