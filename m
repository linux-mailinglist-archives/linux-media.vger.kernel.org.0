Return-Path: <linux-media-owner@vger.kernel.org>
X-Original-To: lists+linux-media@lfdr.de
Delivered-To: lists+linux-media@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id CF354BB646
	for <lists+linux-media@lfdr.de>; Mon, 23 Sep 2019 16:13:03 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2394090AbfIWONC (ORCPT <rfc822;lists+linux-media@lfdr.de>);
        Mon, 23 Sep 2019 10:13:02 -0400
Received: from lb3-smtp-cloud8.xs4all.net ([194.109.24.29]:35563 "EHLO
        lb3-smtp-cloud8.xs4all.net" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S2389738AbfIWONC (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Mon, 23 Sep 2019 10:13:02 -0400
Received: from [192.168.2.10] ([46.9.232.237])
        by smtp-cloud8.xs4all.net with ESMTPA
        id CP5DixrA5KKNGCP5HimHGH; Mon, 23 Sep 2019 16:13:00 +0200
From:   Hans Verkuil <hverkuil@xs4all.nl>
Subject: [ANN] Media sessions in Lyon in October: codecs
To:     Linux Media Mailing List <linux-media@vger.kernel.org>,
        Boris Brezillon <boris.brezillon@collabora.com>,
        Alexandre Courbot <acourbot@chromium.org>,
        Nicolas Dufresne <nicolas@ndufresne.ca>,
        Tomasz Figa <tfiga@chromium.org>,
        Ezequiel Garcia <ezequiel@collabora.com>,
        Daniel Gomez <daniel@qtec.com>,
        Dafna Hirschfeld <dafna.hirschfeld@collabora.com>,
        Eugen Hristev <Eugen.Hristev@microchip.com>,
        Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
        Helen Koike <helen.koike@collabora.com>,
        Michael Tretter <m.tretter@pengutronix.de>
Cc:     Jacopo Mondi <jacopo+renesas@jmondi.org>,
        Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Message-ID: <b3b2c3a6-43d6-ffbd-f94c-e6f92cad8a97@xs4all.nl>
Date:   Mon, 23 Sep 2019 16:12:55 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-CMAE-Envelope: MS4wfPVdSbRweR2meXTLv2EKTUIhYMAam8R3HqPxwXE3c7xL5kEujNX9MWqDqP0oaB1RPdg8RMGZ4AbKFqGitsOr+ca7z6DLwuXCCr1cv8fzbIgugeP8BK2l
 +yWcP4hssYI4Rr0YwBA6PS6ae38Wp6UWh0pT0dX1BUAp2ydgh57JsVqQJdUrZpGl1eWu5ZGVgUrKNdCAbIU95qf4jIrNHr4ojJsL+SeyOvnGD/W7C+Uu+Tha
 l1GAWv/erQRl5T9zrE/QQ/MEoyKP4pAA/el34hiN5A5QES+lS55ERAcXqKS8BnHjs2kHrgCUdRSFFZVD1uxjKb5CRKr8o07LRvTzNYhAsZuRo/jMNFQkks3b
 SQVnRxUxtP9WFPDaeIicfuI4cBNAtHhWAqgJZs8H+vWltebEwecx7WTFacYKKeaov3lE2eWFWw7NW7QyLjKDXMBxKj/IMMJlSZq7xbnt9Qmig1PyatPfglSl
 q/9nkHo/CH90vLCqbEM4oj/Y8ieY/mkcBDKB4gNz+9puWg4+d3100KB+WPSZuA3XtxCB1nk32UyLzg5FXWl2TJtEIOrt6e7IoVi8VdQV5JEYo9Xb0cfeKOl/
 Wun/HQF7AR+kwsp8sCF6A5LOpBbSzcRYNjyYJ/JPMwQX7nqMs9enO+kW9YwuvOz5Z4fa+MoG/KK8V+dhqH3tCPvC
Sender: linux-media-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-media.vger.kernel.org>
X-Mailing-List: linux-media@vger.kernel.org

Hi all,

Since we have three separate half-day sessions for different topics I decided
to split the announcement for this in three emails as well, so these things
can be discussed in separate threads.

All sessions are in room Terreaux VIP Lounge - Level 0.
There is a maximum of 15 people.

The first session deals with the codec API and is on Tuesday morning from
8:30 (tentative, might change) to 12:00 (we have to vacate the room at that
time).

Confirmed attendees for this session:

Boris Brezillon <boris.brezillon@collabora.com>
Alexandre Courbot <acourbot@chromium.org>
Nicolas Dufresne <nicolas@ndufresne.ca>
Tomasz Figa <tfiga@chromium.org>
Ezequiel Garcia <ezequiel@collabora.com>
Daniel Gomez <daniel@qtec.com>
Dafna Hirschfeld <dafna.hirschfeld@collabora.com>
Eugen Hristev <Eugen.Hristev@microchip.com>
Paul Kocialkowski <paul.kocialkowski@bootlin.com>
Helen Koike <helen.koike@collabora.com>
Michael Tretter <m.tretter@pengutronix.de>
Hans Verkuil <hverkuil@xs4all.nl>

Tentative:

Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Jacopo Mondi <jacopo@jmondi.org>

Jacopo, please confirm if you want to attend this session. I didn't find
an email with explicit confirmation, so it was probably done via irc. But since
this session is getting close to capacity I would prefer to keep attendance to
those are actually working with codecs (or will work with it in the near future).

If I missed someone, or you are on the list but won't attend after all, then
please let me know.



Agenda:

- Status of any pending patches related to codec support.

- Requirements of moving codec drivers out of staging.

- Finalize the stateful encoder API. There are two pieces that need
  to be defined:

1) Setting the frame rate so bitrate control can make sense, since
   they need to know this information. This is also relevant for the
   stateless codec (and this may have to change on a per-frame basis
   for stateless codecs!).

   This can either be implemented via ENUM_FRAMEINTERVALS for the coded
   pixelformats and S_PARM support, or we just add a new control for this.
   E.g. V4L2_CID_MPEG_VIDEO_FRAME_INTERVAL (or perhaps FRAME_RATE). If we
   go for a control, then we need to consider the unit. We can use a
   fraction as well. See this series that puts in the foundation for that:
   https://patchwork.linuxtv.org/cover/58857/

   I am inclined to go with a control, since the semantics don't really
   match ENUM_FRAMEINTERVALS/S_PARM. These ioctls still need to be supported
   for legacy drivers. Open question: some drivers (mediatek, hva, coda)
   require S_PARM(OUTPUT), some (venus) allow both S_PARM(CAPTURE) and
   S_PARM(OUTPUT). I am inclined to allow both since this is not a CAPTURE
   vs OUTPUT thing, it is global to both queues.

2) Interactions between OUTPUT and CAPTURE formats.

   The main problem is what to do if the capture sizeimage is too small
   for the OUTPUT resolution when streaming starts.

   Proposal: width and height of S_FMT(OUTPUT) are used to
   calculate a minimum sizeimage (app may request more). This is
   driver-specific. (Is it? Or is this codec-specific?)

   V4L2_FMT_FLAG_FIXED_RESOLUTION is always set for codec formats
   for the encoder (i.e. we don't support mid-stream resolution
   changes for now) and V4L2_EVENT_SOURCE_CHANGE is not
   supported. See https://patchwork.linuxtv.org/patch/56478/ for
   the patch adding this flag.

   Of course, if we start to support mid-stream resolution
   changes (or other changes that require a source change event),
   then this flag should be dropped by the encoder driver and
   documentation on how to handle the source change event should
   be documented in the encoder spec. I prefer to postpone this
   until we have an encoder than can actually do mid-stream
   resolution changes.

   If sizeimage of the OUTPUT is too small for the CAPTURE
   resolution and V4L2_EVENT_SOURCE_CHANGE is not supported,
   then the second STREAMON (either CAPTURE or OUTPUT) will
   return -ENOMEM since there is not enough memory to do the
   encode.

   If V4L2_FMT_FLAG_FIXED_RESOLUTION is set (i.e. that should
   be the case for all current encoders), then any bitrate controls
   will be limited in range to what the current state (CAPTURE and
   OUTPUT formats and frame rate) supports.

- Stateless encoders?

- Anything else? (I have a feeling I missed a codec-related topic, but
  I can't find it in my mailbox)

Regards,

	Hans
