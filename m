Return-Path: <linux-media-owner@vger.kernel.org>
X-Original-To: lists+linux-media@lfdr.de
Delivered-To: lists+linux-media@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 7E85E2A9281
	for <lists+linux-media@lfdr.de>; Fri,  6 Nov 2020 10:26:42 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726127AbgKFJ0l (ORCPT <rfc822;lists+linux-media@lfdr.de>);
        Fri, 6 Nov 2020 04:26:41 -0500
Received: from lb1-smtp-cloud8.xs4all.net ([194.109.24.21]:45151 "EHLO
        lb1-smtp-cloud8.xs4all.net" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S1725893AbgKFJ0j (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Fri, 6 Nov 2020 04:26:39 -0500
Received: from cust-b5b5937f ([IPv6:fc0c:c16d:66b8:757f:c639:739b:9d66:799d])
        by smtp-cloud8.xs4all.net with ESMTPA
        id ay0vkJN2oNanzay0ykrapp; Fri, 06 Nov 2020 10:26:37 +0100
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=xs4all.nl; s=s1;
        t=1604654797; bh=gGvQO/9QxBVS1g+HKw8+0n30vRIUSuexSaVgVF4+BPs=;
        h=Subject:To:From:Message-ID:Date:MIME-Version:Content-Type:From:
         Subject;
        b=QlVeEcGHXVDK6Ziyxr/wH9GOh7mZLggStomlqg6Tbn/5XCUn+K9Bsb89IDRJGpCW7
         zeSCuZcAsxMEQB5K1uBNmlBCh1WL+WFSoh9z1kcXU0iAcDeLMDqfEYiH5eqie8Sbhi
         QxpKibIA9A/LG9KozcyezH/WOkwtTxJBZh3P+lQ7ujQF7FQTBvgzAoac6cxlUcqkre
         v04vN7qkuYSSGYBz4aH872Rs8ienWLNGErZmnu8QXFSqaFPgNruM8dgxKGRAn656be
         N+/8z4AVe5KonxxBp82RIdX4znmP+U3EkkTcSGRZ1XEiLU+LHjOyvqxPnEfqI/b0Mk
         xWfwiC+CeRisA==
Subject: Re: [PATCH v3 2/5] media: uapi: Add MEDIA_BUS_FMT_SENSOR_DATA media
 bus format
To:     Jacopo Mondi <jacopo@jmondi.org>, linux-media@vger.kernel.org
Cc:     naush@raspberrypi.com, dave.stevenson@raspberrypi.com,
        laurent.pinchart@ideasonboard.com, kieran.bingham@ideasonboard.com,
        niklas.soderlund@ragnatech.se, sakari.ailus@iki.fi,
        nsaenzjulienne@suse.de, mchehab+huawei@kernel.org
References: <20201102165258.408049-1-jacopo@jmondi.org>
 <20201102165258.408049-3-jacopo@jmondi.org>
From:   Hans Verkuil <hverkuil@xs4all.nl>
Message-ID: <fa626121-3875-4fcc-f530-ef6449a7a34b@xs4all.nl>
Date:   Fri, 6 Nov 2020 10:26:33 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.12.0
MIME-Version: 1.0
In-Reply-To: <20201102165258.408049-3-jacopo@jmondi.org>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-CMAE-Envelope: MS4xfKGeu2AXUk0e5uww4fUtcXkj2POHHWkWa68mIa4mQ1mvzyEsQAgPWC93lI9dBUoQ1P6C792849GKCMPfPzPeKtKxZk5gqioPb6uE4Jg0Sj1fCQMhU5lG
 4RT0oQtPkQNmCaZn6Hx7aebG1jBnfiAxtwBfzAx08MBK10UQbadulsfP8/OBfCWCNIVb+7lM37E6zvGbu/hxvrlcYgrcQxds0JcBxiO1BcpDeZj9G4wAp4kP
 gBBKoNglMOtJoxE1Y66efZL6Egtcp1qppJvrNro3ClNXUsGGLe2J4z2czPoRt8nDRd4Ui4jgyobVeeFEL73KDvi2JmSJARmX8Q0JfGo/L2Xs6Ot/4GLtYkdz
 XZSwt4cQF/cImnBNxF3xoQDEddCslt+IUEhfchVa56LKKFVskuP5GKzFAgsg9JNsQ3B+EU5OnxVgrKIaODR6BnL9vp8irmP1W4fARGyNHgNBq88w5P+dsrME
 XwY0AGW52ogISSiMS9QKnObbLTGxXu7GTes1xODiKfGvar3zE6y2zZ60rzAV76FGQrTgp7rnNPsMieU9
Precedence: bulk
List-ID: <linux-media.vger.kernel.org>
X-Mailing-List: linux-media@vger.kernel.org

On 02/11/2020 17:52, Jacopo Mondi wrote:
> From: Naushir Patuck <naush@raspberrypi.com>
> 
> This patch adds MEDIA_BUS_FMT_SENSOR_DATA used by the bcm2835-unicam
> driver to support CSI-2 embedded data streams from camera sensors.
> 
> Signed-off-by: Naushir Patuck <naush@raspberrypi.com>
> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
> Signed-off-by: Jacopo Mondi <jacopo@jmondi.org>

This patch needs rebasing after MEDIA_BUS_FMT_METADATA_FIXED was added.

> ---
>  .../media/v4l/subdev-formats.rst              | 32 +++++++++++++++++++
>  include/uapi/linux/media-bus-format.h         |  3 ++
>  2 files changed, 35 insertions(+)
> 
> diff --git a/Documentation/userspace-api/media/v4l/subdev-formats.rst b/Documentation/userspace-api/media/v4l/subdev-formats.rst
> index c9b7bb3ca089d..113d3ac9272ac 100644
> --- a/Documentation/userspace-api/media/v4l/subdev-formats.rst
> +++ b/Documentation/userspace-api/media/v4l/subdev-formats.rst
> @@ -7899,3 +7899,35 @@ formats.
>        - 0x5001
>        - Interleaved raw UYVY and JPEG image format with embedded meta-data
>  	used by Samsung S3C73MX camera sensors.
> +
> +
> +
> +.. _v4l2-mbus-sensor-data:
> +
> +Sensor Ancillary Metadata Formats
> +^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> +
> +This section lists ancillary data generated by a camera sensor and
> +transmitted over a stream on the camera bus.
> +
> +The following table lists the existing sensor ancillary metadata formats:
> +
> +
> +.. _v4l2-mbus-pixelcode-sensor-metadata:
> +
> +.. tabularcolumns:: |p{8.0cm}|p{1.4cm}|p{7.7cm}|
> +
> +.. flat-table:: Sensor ancillary metadata formats
> +    :header-rows:  1
> +    :stub-columns: 0
> +
> +    * - Identifier
> +      - Code
> +      - Comments
> +    * .. _MEDIA_BUS_FMT_SENSOR_DATA:
> +
> +      - MEDIA_BUS_FMT_SENSOR_DATA
> +      - 0x7001
> +      - Sensor vendor specific ancillary metadata. Some vendors follow a generic
> +        CSI-2/SMIA embedded data format as described in the `CSI-2 specification.

Same comment as for the previous patch: this needs to be split up into two formats:
MEDIA_BUS_FMT_METADATA_CSI2_SENSOR_DATA and MEDIA_BUS_FMT_METADATA_CUSTOM_SENSOR_DATA.

> +	<https://mipi.org/specifications/csi-2>`_
> diff --git a/include/uapi/linux/media-bus-format.h b/include/uapi/linux/media-bus-format.h
> index 84fa53ffb13fc..3c2848e91c1b2 100644
> --- a/include/uapi/linux/media-bus-format.h
> +++ b/include/uapi/linux/media-bus-format.h
> @@ -156,4 +156,7 @@
>  /* HSV - next is	0x6002 */
>  #define MEDIA_BUS_FMT_AHSV8888_1X32		0x6001
>  
> +/* Sensor ancillary metadata formats - next is 0x7002 */
> +#define MEDIA_BUS_FMT_SENSOR_DATA		0x7001
> +
>  #endif /* __LINUX_MEDIA_BUS_FORMAT_H */
> 

Regards,

	Hans
