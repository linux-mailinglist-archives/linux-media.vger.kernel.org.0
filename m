Return-Path: <linux-media-owner@vger.kernel.org>
X-Original-To: lists+linux-media@lfdr.de
Delivered-To: lists+linux-media@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id A4E79DAA3E
	for <lists+linux-media@lfdr.de>; Thu, 17 Oct 2019 12:47:23 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2408964AbfJQKrX (ORCPT <rfc822;lists+linux-media@lfdr.de>);
        Thu, 17 Oct 2019 06:47:23 -0400
Received: from lb1-smtp-cloud7.xs4all.net ([194.109.24.24]:59049 "EHLO
        lb1-smtp-cloud7.xs4all.net" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S2408933AbfJQKrW (ORCPT
        <rfc822;linux-media@vger.kernel.org>);
        Thu, 17 Oct 2019 06:47:22 -0400
Received: from [IPv6:2001:420:44c1:2577:5195:3526:c85b:688a]
 ([IPv6:2001:420:44c1:2577:5195:3526:c85b:688a])
        by smtp-cloud7.xs4all.net with ESMTPA
        id L3JMi1W9So1ZhL3JPi6VuG; Thu, 17 Oct 2019 12:47:20 +0200
From:   Hans Verkuil <hverkuil@xs4all.nl>
Subject: [ANN v3] Media sessions in Lyon in October: codecs
To:     Linux Media Mailing List <linux-media@vger.kernel.org>,
        Boris Brezillon <boris.brezillon@collabora.com>,
        Alexandre Courbot <acourbot@chromium.org>,
        Nicolas Dufresne <nicolas@ndufresne.ca>,
        Tomasz Figa <tfiga@chromium.org>,
        Ezequiel Garcia <ezequiel@collabora.com>,
        Daniel Gomez <daniel@qtec.com>,
        Dafna Hirschfeld <dafna.hirschfeld@collabora.com>,
        Eugen Hristev <Eugen.Hristev@microchip.com>,
        Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
        Helen Koike <helen.koike@collabora.com>,
        Michael Tretter <m.tretter@pengutronix.de>
Cc:     Jacopo Mondi <jacopo+renesas@jmondi.org>,
        Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
        Dave Stevenson <dave.stevenson@raspberrypi.org>,
        Stanimir Varbanov <stanimir.varbanov@linaro.org>,
        Maxime Ripard <mripard@kernel.org>
Message-ID: <c8380b43-2742-f1cb-0fb9-2c3c90e29a33@xs4all.nl>
Date:   Thu, 17 Oct 2019 12:47:16 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
X-CMAE-Envelope: MS4wfNVjCuJwZYIOlU2aL16pOJObN+r/+Y+hq3ysaZsrKliyO/ESJcxFE92G5r8if3YuJJWv0WYhKQcBUxueoozLBtCFmvM26FiccGN6Kf2EcGZCRffjzCTi
 Os+ScoCnu0R7CRVbNEPE7x2iv42UhBVbn6DLNA3bsB1pY/abBcYfqXl57tFkE7yVZ4WyBjMOoQMX79qL7BdzkPS3r+ydH6NyN0sCk4ibz/jq+kDPtAOz44ZD
 4CjDs7WAOVSWA4Fdk0iv0VOHUxSnb7T9l61mBzOGv32lENo1pjF5yMy6Y4xp3UMDuCrafUrDnxBSvdNzaf/DuX2iV4f2h7VzmctbP/guLofdP7mLMtuDrRqC
 KyxEqxKj1lXGuyHiklcZNhenDyBP2JyynAm7qDkkB7L23+rBD042U+LuVgY+ZGY2HrOrZacIp87YVpm2gzt7ir7jNjSjL/NskyH/NTDeCVeUdojhqyGyxc1/
 /5ijSo8Fnv94Imm44gusLwnEbOgUfEIObIFISm7THn+l0ur+pohK5KFgZc8uFF9Uu0Ec4lcaA3ZrKoTeHhllPAAhbaW9Ncu5emJbYG/XOtvyW/2r+4L1u7bD
 q+kyHJ0mwZ1s2IYWltO5WnxJEJw5vc/qf8FJ9R4wC3SDqDSy9JBZEce3OBEyp2O8/N6PTEqizsBX7bJ74VrohZRe2cVHgTnBe5DOgcIrkpoovJI7fJaxvcW6
 LZjU8B2TYt59bQRLnt6357lucpKJuNUi/oTA1HJEt/AojtBRsSFFuoOZrUsey9caEjxSAyoiba2P3Q0qdpiTSkOggpikFud/NB733ZG3mUXHgc2sNzlOPhBu
 V3jTXl89+PTHOmRRahMzjLYdLMpZvH9zNCy5IAwmy/jZQYxOZUDjX+kBd29raNfaC4JL/75Q//BZNP0Fy1o=
Sender: linux-media-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-media.vger.kernel.org>
X-Mailing-List: linux-media@vger.kernel.org

(Updated Maxime's email address in v3)

Hi all,

Since we have three separate half-day sessions for different topics I decided
to split the announcement for this in three emails as well, so these things
can be discussed in separate threads.

All sessions are in room Terreaux VIP Lounge - Level 0.
There is a maximum of 15 people.

The first session deals with the codec API and is on Tuesday morning from
8:30 to 12:00 (we have to vacate the room at that time). Note that 8:30
start time!

Confirmed attendees for this session:

Boris Brezillon <boris.brezillon@collabora.com>
Alexandre Courbot <acourbot@chromium.org>
Nicolas Dufresne <nicolas@ndufresne.ca>
Tomasz Figa <tfiga@chromium.org>
Ezequiel Garcia <ezequiel@collabora.com>
Dafna Hirschfeld <dafna.hirschfeld@collabora.com>
Paul Kocialkowski <paul.kocialkowski@bootlin.com>
Maxime Ripard <maxime.ripard@bootlin.com>
Dave Stevenson <dave.stevenson@raspberrypi.org>
Michael Tretter <m.tretter@pengutronix.de>
Stanimir Varbanov <stanimir.varbanov@linaro.org>
Hans Verkuil <hverkuil@xs4all.nl>

Please let me know asap if I missed someone, or if you are listed, but
can't join for some reason.

There are three seats left, and I have five on the 'just interested'
list:

Daniel Gomez <daniel@qtec.com>
Eugen Hristev <Eugen.Hristev@microchip.com>
Helen Koike <helen.koike@collabora.com>
Jacopo Mondi <jacopo@jmondi.org>
Laurent Pinchart <laurent.pinchart@ideasonboard.com>

If you still want to join, please mail me. First come, first served :-)

Agenda:

Note: I didn't assign start times, we'll just go through these items one-by-one.

- Status of any pending patches related to codec support.
  I'll provide a list of those patches by the end of next week so we
  can go through them.

- Requirements of moving codec drivers out of staging.

- Finalize the stateful encoder API. There are two pieces that need
  to be defined:

  1) Setting the frame rate so bitrate control can make sense, since
     they need to know this information. This is also relevant for the
     stateless codec (and this may have to change on a per-frame basis
     for stateless codecs!).

     This can either be implemented via ENUM_FRAMEINTERVALS for the coded
     pixelformats plus S_PARM support, or we just add a new control for this.
     E.g. V4L2_CID_MPEG_VIDEO_FRAME_INTERVAL using struct v4l2_fract.

     I am inclined to go with a control, since the semantics don't really
     match ENUM_FRAMEINTERVALS/S_PARM. These ioctls still need to be supported
     for legacy drivers. Open question: some drivers (mediatek, hva, coda)
     require S_PARM(OUTPUT), some (venus) allow both S_PARM(CAPTURE) and
     S_PARM(OUTPUT). I am inclined to allow both since this is not a CAPTURE
     vs OUTPUT thing, it is global to both queues.

  2) Interactions between OUTPUT and CAPTURE formats.

     The main problem is what to do if the capture sizeimage is too small
     for the OUTPUT resolution when streaming starts.

     Proposal: width and height of S_FMT(OUTPUT) plus max-bitrate plus frame
     interval plus key frame interval info are used to calculate a minimum
     CAPTURE sizeimage (app may request more). This is codec-specific, I think,
     so it should be possible to provide helper functions for this.

     However, it may be quite difficult to make a good calculation. I just
     don't know enough to determine this.

     V4L2_FMT_FLAG_DYN_RESOLUTION is always cleared for codec formats
     for the encoder (i.e. we don't support mid-stream resolution
     changes for now) and V4L2_EVENT_SOURCE_CHANGE is not
     supported.

     Of course, if we start to support mid-stream resolution
     changes (or other changes that require a source change event),
     then this flag should be set by the encoder driver and
     documentation on how to handle the source change event should
     be documented in the encoder spec. I prefer to postpone this
     until we have an encoder than can actually do mid-stream
     resolution changes.

     If sizeimage of the OUTPUT is too small for the CAPTURE
     resolution and V4L2_EVENT_SOURCE_CHANGE is not supported,
     then the second STREAMON (either CAPTURE or OUTPUT) will
     return -ENOMEM since there is not enough memory to do the
     encode.

     If V4L2_FMT_FLAG_DYN_RESOLUTION is cleared (i.e. that is
     the case for all current encoders), then any bitrate controls
     will be limited in range to what the current state (CAPTURE and
     OUTPUT formats and frame interval) supports.

- Stateless encoder support

  Overall goals:

  - Find out if there is a common set of per frame encoding parameters
  - Find out if bitrate control can be reused for multiple HW
  - Decide if we do in-kernel bitrate control or not
  - Decide if we keep bitstream header crafting external (unlike Hantro
    JPEG encoder, but like VAAPI)
  - Decide if we provide (and maintain) a libv4l2 plugin like ChromeOS
    folks opted for.

  I hope Nicolas and Tomasz can prepare for this.

  The one requirement that Cisco would have for these devices is that
  we must be able to do per-frame bitrate control from userspace.

Regards,

	Hans
