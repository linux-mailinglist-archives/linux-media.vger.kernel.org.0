Return-Path: <linux-media+bounces-46081-lists+linux-media=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-media@lfdr.de
Delivered-To: lists+linux-media@lfdr.de
Received: from dfw.mirrors.kernel.org (dfw.mirrors.kernel.org [IPv6:2605:f480:58:1:0:1994:3:14])
	by mail.lfdr.de (Postfix) with ESMTPS id AD060C25C2E
	for <lists+linux-media@lfdr.de>; Fri, 31 Oct 2025 16:08:47 +0100 (CET)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by dfw.mirrors.kernel.org (Postfix) with ESMTPS id 832F44FBCD8
	for <lists+linux-media@lfdr.de>; Fri, 31 Oct 2025 15:01:41 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 1F4DC2D73B9;
	Fri, 31 Oct 2025 14:54:18 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=yandex.ru header.i=@yandex.ru header.b="rmyPQ4oy"
X-Original-To: linux-media@vger.kernel.org
Received: from forward502b.mail.yandex.net (forward502b.mail.yandex.net [178.154.239.146])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 7C05C2D7392
	for <linux-media@vger.kernel.org>; Fri, 31 Oct 2025 14:54:12 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=178.154.239.146
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1761922457; cv=none; b=gTb2xqP8hjgmzJptalQlhVejLh4Ju7J7L2Acihbc003/kcw6mJtTAW4FHlp3RO0zza6Z2UqxAMZwXKnI4sGGReqD/sq6/UNElp9PuCqxwA1TfECXAnozp7XRGkBbPwcX1GTMGTxERuZSg46bdDGBGa1GV1uJRBV5PFuoJwbOIJc=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1761922457; c=relaxed/simple;
	bh=1rEF9ksUXvhCLXjT0fJ0oPEtm0J7PyuEiZd35zih1Fs=;
	h=Content-Type:Message-ID:Date:MIME-Version:To:Cc:References:From:
	 Subject:In-Reply-To; b=l5oaN4MwtQZyYtbuHWPRCSsRKM6Nkx72uioFqojku7lAyryMmNVwRTJ2np6gCl29AGEhbGE5cd3GGjZvwpK9/wkKmZSNXhtl/qjOg24YLVTZ5PJS44YTjroI2suV/9d3A49anWhXmGa9nwotuABSVJhhBdXObCT4T52XnhKKt9I=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=yandex.ru; spf=pass smtp.mailfrom=yandex.ru; dkim=pass (1024-bit key) header.d=yandex.ru header.i=@yandex.ru header.b=rmyPQ4oy; arc=none smtp.client-ip=178.154.239.146
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=yandex.ru
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=yandex.ru
Received: from mail-nwsmtp-smtp-production-main-91.sas.yp-c.yandex.net (mail-nwsmtp-smtp-production-main-91.sas.yp-c.yandex.net [IPv6:2a02:6b8:c1e:3990:0:640:454b:0])
	by forward502b.mail.yandex.net (Yandex) with ESMTPS id 84A1B81B0E;
	Fri, 31 Oct 2025 17:54:02 +0300 (MSK)
Received: by mail-nwsmtp-smtp-production-main-91.sas.yp-c.yandex.net (smtp/Yandex) with ESMTPSA id 0shiUCULQqM0-YZ5cACa6;
	Fri, 31 Oct 2025 17:54:02 +0300
X-Yandex-Fwd: 1
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yandex.ru; s=mail;
	t=1761922442; bh=mEDLmigkAlRtSdP/ndp10HTMv2ZeIus0uGyHOreN8wc=;
	h=In-Reply-To:Cc:Date:References:To:Message-ID:Subject:From;
	b=rmyPQ4oylU2Eg0oP+S7+kgtXN7w1l4D9AQVsb0SSKwHhsMiVeaPmjdmG+HZCccruW
	 pHBorThblXEeTNHhZhmSILNly6h6MtH+EOLPU+5iTvbx7EZxM+7Ue/HCE6MNQ2v1PH
	 PdfPNfgYr0V802rS1n8I8gQduoM9DPF4vAImvqII=
Authentication-Results: mail-nwsmtp-smtp-production-main-91.sas.yp-c.yandex.net; dkim=pass header.i=@yandex.ru
Content-Type: multipart/mixed; boundary="------------TPOrvoVVyvnDe0nsO0b2yJ7c"
Message-ID: <746a20f0-cd31-4ed0-b2e9-f6a445493796@yandex.ru>
Date: Fri, 31 Oct 2025 17:54:00 +0300
Precedence: bulk
X-Mailing-List: linux-media@vger.kernel.org
List-Id: <linux-media.vger.kernel.org>
List-Subscribe: <mailto:linux-media+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-media+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
User-Agent: Mozilla Thunderbird
Content-Language: en-MW
To: Pavel Skripkin <paskripkin@gmail.com>,
 Mauro Carvalho Chehab <mchehab@kernel.org>
Cc: Hans Verkuil <hverkuil-cisco@xs4all.nl>,
 =?UTF-8?Q?Maximilian_B=C3=B6hm?= <maximilian.boehm@elbmurf.de>,
 linux-media@vger.kernel.org
References: <cea19615-2251-45a3-8458-726a92573418@yandex.ru>
 <05582ebc-fbe2-4b54-bdae-ab61fb0894ea@gmail.com>
From: Dmitry Antipov <dmantipov@yandex.ru>
Autocrypt: addr=dmantipov@yandex.ru; keydata=
 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
 A/UwwXBRuvydGV0=
Subject: Re: On https://syzkaller.appspot.com/bug?extid=a6969ef522a36d3344c9
 again
In-Reply-To: <05582ebc-fbe2-4b54-bdae-ab61fb0894ea@gmail.com>

This is a multi-part message in MIME format.
--------------TPOrvoVVyvnDe0nsO0b2yJ7c
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

On 10/31/25 5:25 PM, Pavel Skripkin wrote:

> I barely remember details about this bug. IIRC fix caused failure of some real HW and I had to revert it.

This confuses syzbot which seems knows nothing about revert and thinks that the bug
is fixed. This means that it doesn't even try to reproduce it. But, as of upstream
d127176862a93c4b3216bda533d2bee170af5e71, it can be reproduced manually:

[   34.499427][   T77] list_add corruption. prev->next should be next (ffffffff8f319280), but was 0000000000000000. (prev=ffff8882e1f28.
[   34.500017][   T77] ------------[ cut here ]------------
[   34.500240][   T77] kernel BUG at lib/list_debug.c:34!
[   34.500463][   T77] Oops: invalid opcode: 0000 [#1] SMP KASAN NOPTI
[   34.500730][   T77] CPU: 5 UID: 0 PID: 77 Comm: kworker/5:1 Not tainted 6.18.0-rc3-00131-gd127176862a9 #27 PREEMPT(full)
[   34.501178][   T77] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.17.0-5.fc42 04/01/2014
[   34.501564][   T77] Workqueue: usb_hub_wq hub_event
[   34.501790][   T77] RIP: 0010:__list_add_valid_or_report+0x123/0x130
[   34.502061][   T77] Code: e8 f2 40 5d fd 43 80 3c 2c 00 74 08 4c 89 f7 e8 23 3e 7f fd 49 8b 16 48 c7 c7 20 0a e1 8b 48 89 de 4c 89 f0
[   34.502843][   T77] RSP: 0018:ffffc900036f6aa0 EFLAGS: 00010246
[   34.503093][   T77] RAX: 0000000000000075 RBX: ffffffff8f319280 RCX: a062c2e832bfe100
[   34.503415][   T77] RDX: 0000000000000000 RSI: 0000000080000000 RDI: 0000000000000000
[   34.503751][   T77] RBP: 1ffffffff1e63251 R08: ffff888535f242d3 R09: 1ffff110a6be485a
[   34.504073][   T77] R10: dffffc0000000000 R11: ffffed10a6be485b R12: 1ffff1105c3e504a
[   34.504396][   T77] R13: dffffc0000000000 R14: ffff8882e1f28250 R15: ffff8882e8ccc250
[   34.504720][   T77] FS:  0000000000000000(0000) GS:ffff8885a33df000(0000) knlGS:0000000000000000
[   34.505081][   T77] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   34.505349][   T77] CR2: 00007fcf1b131688 CR3: 00000001215df000 CR4: 0000000000752ef0
[   34.505672][   T77] PKRU: 55555554
[   34.505823][   T77] Call Trace:
[   34.505961][   T77]  <TASK>
[   34.506084][   T77]  em28xx_init_extension+0x56/0x1c0
...

using at least one of the reproducers (attached).

Dmitry

--------------TPOrvoVVyvnDe0nsO0b2yJ7c
Content-Type: text/x-csrc; charset=UTF-8; name="repro-a6969ef522a36d3344c9.c"
Content-Disposition: attachment; filename="repro-a6969ef522a36d3344c9.c"
Content-Transfer-Encoding: base64

Ly8gaHR0cHM6Ly9zeXprYWxsZXIuYXBwc3BvdC5jb20vYnVnP2lkPTM2MDliYmY0NWJmNjNh
OGY2MDMyZjMzMGViM2QzNGY1MWNjODE0OTMKLy8gYXV0b2dlbmVyYXRlZCBieSBzeXprYWxs
ZXIgKGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvc3l6a2FsbGVyKQoKI2RlZmluZSBfR05V
X1NPVVJDRQoKI2luY2x1ZGUgPGRpcmVudC5oPgojaW5jbHVkZSA8ZW5kaWFuLmg+CiNpbmNs
dWRlIDxlcnJuby5oPgojaW5jbHVkZSA8ZmNudGwuaD4KI2luY2x1ZGUgPHNpZ25hbC5oPgoj
aW5jbHVkZSA8c3RkYXJnLmg+CiNpbmNsdWRlIDxzdGRib29sLmg+CiNpbmNsdWRlIDxzdGRk
ZWYuaD4KI2luY2x1ZGUgPHN0ZGludC5oPgojaW5jbHVkZSA8c3RkaW8uaD4KI2luY2x1ZGUg
PHN0ZGxpYi5oPgojaW5jbHVkZSA8c3RyaW5nLmg+CiNpbmNsdWRlIDxzeXMvbW91bnQuaD4K
I2luY2x1ZGUgPHN5cy9wcmN0bC5oPgojaW5jbHVkZSA8c3lzL3N0YXQuaD4KI2luY2x1ZGUg
PHN5cy9zeXNjYWxsLmg+CiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KI2luY2x1ZGUgPHN5cy93
YWl0Lmg+CiNpbmNsdWRlIDx0aW1lLmg+CiNpbmNsdWRlIDx1bmlzdGQuaD4KCiNpbmNsdWRl
IDxsaW51eC91c2IvY2g5Lmg+CgpzdGF0aWMgdW5zaWduZWQgbG9uZyBsb25nIHByb2NpZDsK
CnN0YXRpYyB2b2lkIHNsZWVwX21zKHVpbnQ2NF90IG1zKQp7CiAgdXNsZWVwKG1zICogMTAw
MCk7Cn0KCnN0YXRpYyB1aW50NjRfdCBjdXJyZW50X3RpbWVfbXModm9pZCkKewogIHN0cnVj
dCB0aW1lc3BlYyB0czsKICBpZiAoY2xvY2tfZ2V0dGltZShDTE9DS19NT05PVE9OSUMsICZ0
cykpCiAgICBleGl0KDEpOwogIHJldHVybiAodWludDY0X3QpdHMudHZfc2VjICogMTAwMCAr
ICh1aW50NjRfdCl0cy50dl9uc2VjIC8gMTAwMDAwMDsKfQoKc3RhdGljIGJvb2wgd3JpdGVf
ZmlsZShjb25zdCBjaGFyKiBmaWxlLCBjb25zdCBjaGFyKiB3aGF0LCAuLi4pCnsKICBjaGFy
IGJ1ZlsxMDI0XTsKICB2YV9saXN0IGFyZ3M7CiAgdmFfc3RhcnQoYXJncywgd2hhdCk7CiAg
dnNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksIHdoYXQsIGFyZ3MpOwogIHZhX2VuZChhcmdz
KTsKICBidWZbc2l6ZW9mKGJ1ZikgLSAxXSA9IDA7CiAgaW50IGxlbiA9IHN0cmxlbihidWYp
OwogIGludCBmZCA9IG9wZW4oZmlsZSwgT19XUk9OTFkgfCBPX0NMT0VYRUMpOwogIGlmIChm
ZCA9PSAtMSkKICAgIHJldHVybiBmYWxzZTsKICBpZiAod3JpdGUoZmQsIGJ1ZiwgbGVuKSAh
PSBsZW4pIHsKICAgIGludCBlcnIgPSBlcnJubzsKICAgIGNsb3NlKGZkKTsKICAgIGVycm5v
ID0gZXJyOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjbG9zZShmZCk7CiAgcmV0dXJuIHRy
dWU7Cn0KCiNkZWZpbmUgTUFYX0ZEUyAzMAoKI2RlZmluZSBVU0JfTUFYX0lGQUNFX05VTSA0
CiNkZWZpbmUgVVNCX01BWF9FUF9OVU0gMzIKI2RlZmluZSBVU0JfTUFYX0ZEUyA2CgpzdHJ1
Y3QgdXNiX2VuZHBvaW50X2luZGV4IHsKICBzdHJ1Y3QgdXNiX2VuZHBvaW50X2Rlc2NyaXB0
b3IgZGVzYzsKICBpbnQgaGFuZGxlOwp9OwoKc3RydWN0IHVzYl9pZmFjZV9pbmRleCB7CiAg
c3RydWN0IHVzYl9pbnRlcmZhY2VfZGVzY3JpcHRvciogaWZhY2U7CiAgdWludDhfdCBiSW50
ZXJmYWNlTnVtYmVyOwogIHVpbnQ4X3QgYkFsdGVybmF0ZVNldHRpbmc7CiAgdWludDhfdCBi
SW50ZXJmYWNlQ2xhc3M7CiAgc3RydWN0IHVzYl9lbmRwb2ludF9pbmRleCBlcHNbVVNCX01B
WF9FUF9OVU1dOwogIGludCBlcHNfbnVtOwp9OwoKc3RydWN0IHVzYl9kZXZpY2VfaW5kZXgg
ewogIHN0cnVjdCB1c2JfZGV2aWNlX2Rlc2NyaXB0b3IqIGRldjsKICBzdHJ1Y3QgdXNiX2Nv
bmZpZ19kZXNjcmlwdG9yKiBjb25maWc7CiAgdWludDhfdCBiRGV2aWNlQ2xhc3M7CiAgdWlu
dDhfdCBiTWF4UG93ZXI7CiAgaW50IGNvbmZpZ19sZW5ndGg7CiAgc3RydWN0IHVzYl9pZmFj
ZV9pbmRleCBpZmFjZXNbVVNCX01BWF9JRkFDRV9OVU1dOwogIGludCBpZmFjZXNfbnVtOwog
IGludCBpZmFjZV9jdXI7Cn07CgpzdHJ1Y3QgdXNiX2luZm8gewogIGludCBmZDsKICBzdHJ1
Y3QgdXNiX2RldmljZV9pbmRleCBpbmRleDsKfTsKCnN0YXRpYyBzdHJ1Y3QgdXNiX2luZm8g
dXNiX2RldmljZXNbVVNCX01BWF9GRFNdOwpzdGF0aWMgaW50IHVzYl9kZXZpY2VzX251bTsK
CnN0YXRpYyBib29sIHBhcnNlX3VzYl9kZXNjcmlwdG9yKGNvbnN0IGNoYXIqIGJ1ZmZlciwg
c2l6ZV90IGxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IHVzYl9kZXZpY2VfaW5kZXgqIGluZGV4KQp7CiAgaWYgKGxlbmd0aCA8IHNpemVvZigqaW5k
ZXgtPmRldikgKyBzaXplb2YoKmluZGV4LT5jb25maWcpKQogICAgcmV0dXJuIGZhbHNlOwog
IG1lbXNldChpbmRleCwgMCwgc2l6ZW9mKCppbmRleCkpOwogIGluZGV4LT5kZXYgPSAoc3Ry
dWN0IHVzYl9kZXZpY2VfZGVzY3JpcHRvciopYnVmZmVyOwogIGluZGV4LT5jb25maWcgPSAo
c3RydWN0IHVzYl9jb25maWdfZGVzY3JpcHRvciopKGJ1ZmZlciArIHNpemVvZigqaW5kZXgt
PmRldikpOwogIGluZGV4LT5iRGV2aWNlQ2xhc3MgPSBpbmRleC0+ZGV2LT5iRGV2aWNlQ2xh
c3M7CiAgaW5kZXgtPmJNYXhQb3dlciA9IGluZGV4LT5jb25maWctPmJNYXhQb3dlcjsKICBp
bmRleC0+Y29uZmlnX2xlbmd0aCA9IGxlbmd0aCAtIHNpemVvZigqaW5kZXgtPmRldik7CiAg
aW5kZXgtPmlmYWNlX2N1ciA9IC0xOwogIHNpemVfdCBvZmZzZXQgPSAwOwogIHdoaWxlICh0
cnVlKSB7CiAgICBpZiAob2Zmc2V0ICsgMSA+PSBsZW5ndGgpCiAgICAgIGJyZWFrOwogICAg
dWludDhfdCBkZXNjX2xlbmd0aCA9IGJ1ZmZlcltvZmZzZXRdOwogICAgdWludDhfdCBkZXNj
X3R5cGUgPSBidWZmZXJbb2Zmc2V0ICsgMV07CiAgICBpZiAoZGVzY19sZW5ndGggPD0gMikK
ICAgICAgYnJlYWs7CiAgICBpZiAob2Zmc2V0ICsgZGVzY19sZW5ndGggPiBsZW5ndGgpCiAg
ICAgIGJyZWFrOwogICAgaWYgKGRlc2NfdHlwZSA9PSBVU0JfRFRfSU5URVJGQUNFICYmCiAg
ICAgICAgaW5kZXgtPmlmYWNlc19udW0gPCBVU0JfTUFYX0lGQUNFX05VTSkgewogICAgICBz
dHJ1Y3QgdXNiX2ludGVyZmFjZV9kZXNjcmlwdG9yKiBpZmFjZSA9CiAgICAgICAgICAoc3Ry
dWN0IHVzYl9pbnRlcmZhY2VfZGVzY3JpcHRvciopKGJ1ZmZlciArIG9mZnNldCk7CiAgICAg
IGluZGV4LT5pZmFjZXNbaW5kZXgtPmlmYWNlc19udW1dLmlmYWNlID0gaWZhY2U7CiAgICAg
IGluZGV4LT5pZmFjZXNbaW5kZXgtPmlmYWNlc19udW1dLmJJbnRlcmZhY2VOdW1iZXIgPQog
ICAgICAgICAgaWZhY2UtPmJJbnRlcmZhY2VOdW1iZXI7CiAgICAgIGluZGV4LT5pZmFjZXNb
aW5kZXgtPmlmYWNlc19udW1dLmJBbHRlcm5hdGVTZXR0aW5nID0KICAgICAgICAgIGlmYWNl
LT5iQWx0ZXJuYXRlU2V0dGluZzsKICAgICAgaW5kZXgtPmlmYWNlc1tpbmRleC0+aWZhY2Vz
X251bV0uYkludGVyZmFjZUNsYXNzID0gaWZhY2UtPmJJbnRlcmZhY2VDbGFzczsKICAgICAg
aW5kZXgtPmlmYWNlc19udW0rKzsKICAgIH0KICAgIGlmIChkZXNjX3R5cGUgPT0gVVNCX0RU
X0VORFBPSU5UICYmIGluZGV4LT5pZmFjZXNfbnVtID4gMCkgewogICAgICBzdHJ1Y3QgdXNi
X2lmYWNlX2luZGV4KiBpZmFjZSA9ICZpbmRleC0+aWZhY2VzW2luZGV4LT5pZmFjZXNfbnVt
IC0gMV07CiAgICAgIGlmIChpZmFjZS0+ZXBzX251bSA8IFVTQl9NQVhfRVBfTlVNKSB7CiAg
ICAgICAgbWVtY3B5KCZpZmFjZS0+ZXBzW2lmYWNlLT5lcHNfbnVtXS5kZXNjLCBidWZmZXIg
KyBvZmZzZXQsCiAgICAgICAgICAgICAgIHNpemVvZihpZmFjZS0+ZXBzW2lmYWNlLT5lcHNf
bnVtXS5kZXNjKSk7CiAgICAgICAgaWZhY2UtPmVwc19udW0rKzsKICAgICAgfQogICAgfQog
ICAgb2Zmc2V0ICs9IGRlc2NfbGVuZ3RoOwogIH0KICByZXR1cm4gdHJ1ZTsKfQoKc3RhdGlj
IHN0cnVjdCB1c2JfZGV2aWNlX2luZGV4KiBhZGRfdXNiX2luZGV4KGludCBmZCwgY29uc3Qg
Y2hhciogZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc2l6ZV90IGRldl9sZW4pCnsKICBpbnQgaSA9IF9fYXRvbWljX2ZldGNoX2FkZCgmdXNi
X2RldmljZXNfbnVtLCAxLCBfX0FUT01JQ19SRUxBWEVEKTsKICBpZiAoaSA+PSBVU0JfTUFY
X0ZEUykKICAgIHJldHVybiBOVUxMOwogIGlmICghcGFyc2VfdXNiX2Rlc2NyaXB0b3IoZGV2
LCBkZXZfbGVuLCAmdXNiX2RldmljZXNbaV0uaW5kZXgpKQogICAgcmV0dXJuIE5VTEw7CiAg
X19hdG9taWNfc3RvcmVfbigmdXNiX2RldmljZXNbaV0uZmQsIGZkLCBfX0FUT01JQ19SRUxF
QVNFKTsKICByZXR1cm4gJnVzYl9kZXZpY2VzW2ldLmluZGV4Owp9CgpzdGF0aWMgc3RydWN0
IHVzYl9kZXZpY2VfaW5kZXgqIGxvb2t1cF91c2JfaW5kZXgoaW50IGZkKQp7CiAgZm9yIChp
bnQgaSA9IDA7IGkgPCBVU0JfTUFYX0ZEUzsgaSsrKSB7CiAgICBpZiAoX19hdG9taWNfbG9h
ZF9uKCZ1c2JfZGV2aWNlc1tpXS5mZCwgX19BVE9NSUNfQUNRVUlSRSkgPT0gZmQpIHsKICAg
ICAgcmV0dXJuICZ1c2JfZGV2aWNlc1tpXS5pbmRleDsKICAgIH0KICB9CiAgcmV0dXJuIE5V
TEw7Cn0KCnN0cnVjdCB2dXNiX2Nvbm5lY3Rfc3RyaW5nX2Rlc2NyaXB0b3IgewogIHVpbnQz
Ml90IGxlbjsKICBjaGFyKiBzdHI7Cn0gX19hdHRyaWJ1dGVfXygocGFja2VkKSk7CgpzdHJ1
Y3QgdnVzYl9jb25uZWN0X2Rlc2NyaXB0b3JzIHsKICB1aW50MzJfdCBxdWFsX2xlbjsKICBj
aGFyKiBxdWFsOwogIHVpbnQzMl90IGJvc19sZW47CiAgY2hhciogYm9zOwogIHVpbnQzMl90
IHN0cnNfbGVuOwogIHN0cnVjdCB2dXNiX2Nvbm5lY3Rfc3RyaW5nX2Rlc2NyaXB0b3Igc3Ry
c1swXTsKfSBfX2F0dHJpYnV0ZV9fKChwYWNrZWQpKTsKCnN0YXRpYyBjb25zdCBjaGFyIGRl
ZmF1bHRfc3RyaW5nW10gPSB7OCwgVVNCX0RUX1NUUklORywgJ3MnLCAwLCAneScsIDAsICd6
JywgMH07CgpzdGF0aWMgY29uc3QgY2hhciBkZWZhdWx0X2xhbmdfaWRbXSA9IHs0LCBVU0Jf
RFRfU1RSSU5HLCAweDA5LCAweDA0fTsKCnN0YXRpYyBib29sCmxvb2t1cF9jb25uZWN0X3Jl
c3BvbnNlX2luKGludCBmZCwgY29uc3Qgc3RydWN0IHZ1c2JfY29ubmVjdF9kZXNjcmlwdG9y
cyogZGVzY3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB1c2Jf
Y3RybHJlcXVlc3QqIGN0cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIqKiBy
ZXNwb25zZV9kYXRhLCB1aW50MzJfdCogcmVzcG9uc2VfbGVuZ3RoKQp7CiAgc3RydWN0IHVz
Yl9kZXZpY2VfaW5kZXgqIGluZGV4ID0gbG9va3VwX3VzYl9pbmRleChmZCk7CiAgdWludDhf
dCBzdHJfaWR4OwogIGlmICghaW5kZXgpCiAgICByZXR1cm4gZmFsc2U7CiAgc3dpdGNoIChj
dHJsLT5iUmVxdWVzdFR5cGUgJiBVU0JfVFlQRV9NQVNLKSB7CiAgY2FzZSBVU0JfVFlQRV9T
VEFOREFSRDoKICAgIHN3aXRjaCAoY3RybC0+YlJlcXVlc3QpIHsKICAgIGNhc2UgVVNCX1JF
UV9HRVRfREVTQ1JJUFRPUjoKICAgICAgc3dpdGNoIChjdHJsLT53VmFsdWUgPj4gOCkgewog
ICAgICBjYXNlIFVTQl9EVF9ERVZJQ0U6CiAgICAgICAgKnJlc3BvbnNlX2RhdGEgPSAoY2hh
ciopaW5kZXgtPmRldjsKICAgICAgICAqcmVzcG9uc2VfbGVuZ3RoID0gc2l6ZW9mKCppbmRl
eC0+ZGV2KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgY2FzZSBVU0JfRFRfQ09ORklH
OgogICAgICAgICpyZXNwb25zZV9kYXRhID0gKGNoYXIqKWluZGV4LT5jb25maWc7CiAgICAg
ICAgKnJlc3BvbnNlX2xlbmd0aCA9IGluZGV4LT5jb25maWdfbGVuZ3RoOwogICAgICAgIHJl
dHVybiB0cnVlOwogICAgICBjYXNlIFVTQl9EVF9TVFJJTkc6CiAgICAgICAgc3RyX2lkeCA9
ICh1aW50OF90KWN0cmwtPndWYWx1ZTsKICAgICAgICBpZiAoZGVzY3MgJiYgc3RyX2lkeCA8
IGRlc2NzLT5zdHJzX2xlbikgewogICAgICAgICAgKnJlc3BvbnNlX2RhdGEgPSBkZXNjcy0+
c3Ryc1tzdHJfaWR4XS5zdHI7CiAgICAgICAgICAqcmVzcG9uc2VfbGVuZ3RoID0gZGVzY3Mt
PnN0cnNbc3RyX2lkeF0ubGVuOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQog
ICAgICAgIGlmIChzdHJfaWR4ID09IDApIHsKICAgICAgICAgICpyZXNwb25zZV9kYXRhID0g
KGNoYXIqKSZkZWZhdWx0X2xhbmdfaWRbMF07CiAgICAgICAgICAqcmVzcG9uc2VfbGVuZ3Ro
ID0gZGVmYXVsdF9sYW5nX2lkWzBdOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg
fQogICAgICAgICpyZXNwb25zZV9kYXRhID0gKGNoYXIqKSZkZWZhdWx0X3N0cmluZ1swXTsK
ICAgICAgICAqcmVzcG9uc2VfbGVuZ3RoID0gZGVmYXVsdF9zdHJpbmdbMF07CiAgICAgICAg
cmV0dXJuIHRydWU7CiAgICAgIGNhc2UgVVNCX0RUX0JPUzoKICAgICAgICAqcmVzcG9uc2Vf
ZGF0YSA9IGRlc2NzLT5ib3M7CiAgICAgICAgKnJlc3BvbnNlX2xlbmd0aCA9IGRlc2NzLT5i
b3NfbGVuOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICBjYXNlIFVTQl9EVF9ERVZJQ0Vf
UVVBTElGSUVSOgogICAgICAgIGlmICghZGVzY3MtPnF1YWwpIHsKICAgICAgICAgIHN0cnVj
dCB1c2JfcXVhbGlmaWVyX2Rlc2NyaXB0b3IqIHF1YWwgPQogICAgICAgICAgICAgIChzdHJ1
Y3QgdXNiX3F1YWxpZmllcl9kZXNjcmlwdG9yKilyZXNwb25zZV9kYXRhOwogICAgICAgICAg
cXVhbC0+Ykxlbmd0aCA9IHNpemVvZigqcXVhbCk7CiAgICAgICAgICBxdWFsLT5iRGVzY3Jp
cHRvclR5cGUgPSBVU0JfRFRfREVWSUNFX1FVQUxJRklFUjsKICAgICAgICAgIHF1YWwtPmJj
ZFVTQiA9IGluZGV4LT5kZXYtPmJjZFVTQjsKICAgICAgICAgIHF1YWwtPmJEZXZpY2VDbGFz
cyA9IGluZGV4LT5kZXYtPmJEZXZpY2VDbGFzczsKICAgICAgICAgIHF1YWwtPmJEZXZpY2VT
dWJDbGFzcyA9IGluZGV4LT5kZXYtPmJEZXZpY2VTdWJDbGFzczsKICAgICAgICAgIHF1YWwt
PmJEZXZpY2VQcm90b2NvbCA9IGluZGV4LT5kZXYtPmJEZXZpY2VQcm90b2NvbDsKICAgICAg
ICAgIHF1YWwtPmJNYXhQYWNrZXRTaXplMCA9IGluZGV4LT5kZXYtPmJNYXhQYWNrZXRTaXpl
MDsKICAgICAgICAgIHF1YWwtPmJOdW1Db25maWd1cmF0aW9ucyA9IGluZGV4LT5kZXYtPmJO
dW1Db25maWd1cmF0aW9uczsKICAgICAgICAgIHF1YWwtPmJSRVNFUlZFRCA9IDA7CiAgICAg
ICAgICAqcmVzcG9uc2VfbGVuZ3RoID0gc2l6ZW9mKCpxdWFsKTsKICAgICAgICAgIHJldHVy
biB0cnVlOwogICAgICAgIH0KICAgICAgICAqcmVzcG9uc2VfZGF0YSA9IGRlc2NzLT5xdWFs
OwogICAgICAgICpyZXNwb25zZV9sZW5ndGggPSBkZXNjcy0+cXVhbF9sZW47CiAgICAgICAg
cmV0dXJuIHRydWU7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAg
ICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICBicmVhazsKICAgIH0KICAgIGJyZWFrOwog
IGRlZmF1bHQ6CiAgICBicmVhazsKICB9CiAgcmV0dXJuIGZhbHNlOwp9Cgp0eXBlZGVmIGJv
b2wgKCpsb29rdXBfY29ubmVjdF9vdXRfcmVzcG9uc2VfdCkoCiAgICBpbnQgZmQsIGNvbnN0
IHN0cnVjdCB2dXNiX2Nvbm5lY3RfZGVzY3JpcHRvcnMqIGRlc2NzLAogICAgY29uc3Qgc3Ry
dWN0IHVzYl9jdHJscmVxdWVzdCogY3RybCwgYm9vbCogZG9uZSk7CgpzdGF0aWMgYm9vbCBs
b29rdXBfY29ubmVjdF9yZXNwb25zZV9vdXRfZ2VuZXJpYygKICAgIGludCBmZCwgY29uc3Qg
c3RydWN0IHZ1c2JfY29ubmVjdF9kZXNjcmlwdG9ycyogZGVzY3MsCiAgICBjb25zdCBzdHJ1
Y3QgdXNiX2N0cmxyZXF1ZXN0KiBjdHJsLCBib29sKiBkb25lKQp7CiAgc3dpdGNoIChjdHJs
LT5iUmVxdWVzdFR5cGUgJiBVU0JfVFlQRV9NQVNLKSB7CiAgY2FzZSBVU0JfVFlQRV9TVEFO
REFSRDoKICAgIHN3aXRjaCAoY3RybC0+YlJlcXVlc3QpIHsKICAgIGNhc2UgVVNCX1JFUV9T
RVRfQ09ORklHVVJBVElPTjoKICAgICAgKmRvbmUgPSB0cnVlOwogICAgICByZXR1cm4gdHJ1
ZTsKICAgIGRlZmF1bHQ6CiAgICAgIGJyZWFrOwogICAgfQogICAgYnJlYWs7CiAgfQogIHJl
dHVybiBmYWxzZTsKfQoKI2RlZmluZSBVRENfTkFNRV9MRU5HVEhfTUFYIDEyOAoKc3RydWN0
IHVzYl9yYXdfaW5pdCB7CiAgX191OCBkcml2ZXJfbmFtZVtVRENfTkFNRV9MRU5HVEhfTUFY
XTsKICBfX3U4IGRldmljZV9uYW1lW1VEQ19OQU1FX0xFTkdUSF9NQVhdOwogIF9fdTggc3Bl
ZWQ7Cn07CgplbnVtIHVzYl9yYXdfZXZlbnRfdHlwZSB7CiAgVVNCX1JBV19FVkVOVF9JTlZB
TElEID0gMCwKICBVU0JfUkFXX0VWRU5UX0NPTk5FQ1QgPSAxLAogIFVTQl9SQVdfRVZFTlRf
Q09OVFJPTCA9IDIsCn07CgpzdHJ1Y3QgdXNiX3Jhd19ldmVudCB7CiAgX191MzIgdHlwZTsK
ICBfX3UzMiBsZW5ndGg7CiAgX191OCBkYXRhWzBdOwp9OwoKc3RydWN0IHVzYl9yYXdfZXBf
aW8gewogIF9fdTE2IGVwOwogIF9fdTE2IGZsYWdzOwogIF9fdTMyIGxlbmd0aDsKICBfX3U4
IGRhdGFbMF07Cn07CgojZGVmaW5lIFVTQl9SQVdfRVBTX05VTV9NQVggMzAKI2RlZmluZSBV
U0JfUkFXX0VQX05BTUVfTUFYIDE2CiNkZWZpbmUgVVNCX1JBV19FUF9BRERSX0FOWSAweGZm
CgpzdHJ1Y3QgdXNiX3Jhd19lcF9jYXBzIHsKICBfX3UzMiB0eXBlX2NvbnRyb2wgOiAxOwog
IF9fdTMyIHR5cGVfaXNvIDogMTsKICBfX3UzMiB0eXBlX2J1bGsgOiAxOwogIF9fdTMyIHR5
cGVfaW50IDogMTsKICBfX3UzMiBkaXJfaW4gOiAxOwogIF9fdTMyIGRpcl9vdXQgOiAxOwp9
OwoKc3RydWN0IHVzYl9yYXdfZXBfbGltaXRzIHsKICBfX3UxNiBtYXhwYWNrZXRfbGltaXQ7
CiAgX191MTYgbWF4X3N0cmVhbXM7CiAgX191MzIgcmVzZXJ2ZWQ7Cn07CgpzdHJ1Y3QgdXNi
X3Jhd19lcF9pbmZvIHsKICBfX3U4IG5hbWVbVVNCX1JBV19FUF9OQU1FX01BWF07CiAgX191
MzIgYWRkcjsKICBzdHJ1Y3QgdXNiX3Jhd19lcF9jYXBzIGNhcHM7CiAgc3RydWN0IHVzYl9y
YXdfZXBfbGltaXRzIGxpbWl0czsKfTsKCnN0cnVjdCB1c2JfcmF3X2Vwc19pbmZvIHsKICBz
dHJ1Y3QgdXNiX3Jhd19lcF9pbmZvIGVwc1tVU0JfUkFXX0VQU19OVU1fTUFYXTsKfTsKCiNk
ZWZpbmUgVVNCX1JBV19JT0NUTF9JTklUIF9JT1coJ1UnLCAwLCBzdHJ1Y3QgdXNiX3Jhd19p
bml0KQojZGVmaW5lIFVTQl9SQVdfSU9DVExfUlVOIF9JTygnVScsIDEpCiNkZWZpbmUgVVNC
X1JBV19JT0NUTF9FVkVOVF9GRVRDSCBfSU9SKCdVJywgMiwgc3RydWN0IHVzYl9yYXdfZXZl
bnQpCiNkZWZpbmUgVVNCX1JBV19JT0NUTF9FUDBfV1JJVEUgX0lPVygnVScsIDMsIHN0cnVj
dCB1c2JfcmF3X2VwX2lvKQojZGVmaW5lIFVTQl9SQVdfSU9DVExfRVAwX1JFQUQgX0lPV1Io
J1UnLCA0LCBzdHJ1Y3QgdXNiX3Jhd19lcF9pbykKI2RlZmluZSBVU0JfUkFXX0lPQ1RMX0VQ
X0VOQUJMRSBfSU9XKCdVJywgNSwgc3RydWN0IHVzYl9lbmRwb2ludF9kZXNjcmlwdG9yKQoj
ZGVmaW5lIFVTQl9SQVdfSU9DVExfRVBfRElTQUJMRSBfSU9XKCdVJywgNiwgX191MzIpCiNk
ZWZpbmUgVVNCX1JBV19JT0NUTF9FUF9XUklURSBfSU9XKCdVJywgNywgc3RydWN0IHVzYl9y
YXdfZXBfaW8pCiNkZWZpbmUgVVNCX1JBV19JT0NUTF9FUF9SRUFEIF9JT1dSKCdVJywgOCwg
c3RydWN0IHVzYl9yYXdfZXBfaW8pCiNkZWZpbmUgVVNCX1JBV19JT0NUTF9DT05GSUdVUkUg
X0lPKCdVJywgOSkKI2RlZmluZSBVU0JfUkFXX0lPQ1RMX1ZCVVNfRFJBVyBfSU9XKCdVJywg
MTAsIF9fdTMyKQojZGVmaW5lIFVTQl9SQVdfSU9DVExfRVBTX0lORk8gX0lPUignVScsIDEx
LCBzdHJ1Y3QgdXNiX3Jhd19lcHNfaW5mbykKI2RlZmluZSBVU0JfUkFXX0lPQ1RMX0VQMF9T
VEFMTCBfSU8oJ1UnLCAxMikKI2RlZmluZSBVU0JfUkFXX0lPQ1RMX0VQX1NFVF9IQUxUIF9J
T1coJ1UnLCAxMywgX191MzIpCiNkZWZpbmUgVVNCX1JBV19JT0NUTF9FUF9DTEVBUl9IQUxU
IF9JT1coJ1UnLCAxNCwgX191MzIpCiNkZWZpbmUgVVNCX1JBV19JT0NUTF9FUF9TRVRfV0VE
R0UgX0lPVygnVScsIDE1LCBfX3UzMikKCnN0YXRpYyBpbnQgdXNiX3Jhd19vcGVuKCkKewog
IHJldHVybiBvcGVuKCIvZGV2L3Jhdy1nYWRnZXQiLCBPX1JEV1IpOwp9CgpzdGF0aWMgaW50
IHVzYl9yYXdfaW5pdChpbnQgZmQsIHVpbnQzMl90IHNwZWVkLCBjb25zdCBjaGFyKiBkcml2
ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGRldmljZSkKewogIHN0
cnVjdCB1c2JfcmF3X2luaXQgYXJnOwogIHN0cm5jcHkoKGNoYXIqKSZhcmcuZHJpdmVyX25h
bWVbMF0sIGRyaXZlciwgc2l6ZW9mKGFyZy5kcml2ZXJfbmFtZSkpOwogIHN0cm5jcHkoKGNo
YXIqKSZhcmcuZGV2aWNlX25hbWVbMF0sIGRldmljZSwgc2l6ZW9mKGFyZy5kZXZpY2VfbmFt
ZSkpOwogIGFyZy5zcGVlZCA9IHNwZWVkOwogIHJldHVybiBpb2N0bChmZCwgVVNCX1JBV19J
T0NUTF9JTklULCAmYXJnKTsKfQoKc3RhdGljIGludCB1c2JfcmF3X3J1bihpbnQgZmQpCnsK
ICByZXR1cm4gaW9jdGwoZmQsIFVTQl9SQVdfSU9DVExfUlVOLCAwKTsKfQoKc3RhdGljIGlu
dCB1c2JfcmF3X2V2ZW50X2ZldGNoKGludCBmZCwgc3RydWN0IHVzYl9yYXdfZXZlbnQqIGV2
ZW50KQp7CiAgcmV0dXJuIGlvY3RsKGZkLCBVU0JfUkFXX0lPQ1RMX0VWRU5UX0ZFVENILCBl
dmVudCk7Cn0KCnN0YXRpYyBpbnQgdXNiX3Jhd19lcDBfd3JpdGUoaW50IGZkLCBzdHJ1Y3Qg
dXNiX3Jhd19lcF9pbyogaW8pCnsKICByZXR1cm4gaW9jdGwoZmQsIFVTQl9SQVdfSU9DVExf
RVAwX1dSSVRFLCBpbyk7Cn0KCnN0YXRpYyBpbnQgdXNiX3Jhd19lcDBfcmVhZChpbnQgZmQs
IHN0cnVjdCB1c2JfcmF3X2VwX2lvKiBpbykKewogIHJldHVybiBpb2N0bChmZCwgVVNCX1JB
V19JT0NUTF9FUDBfUkVBRCwgaW8pOwp9CgpzdGF0aWMgaW50IHVzYl9yYXdfZXBfZW5hYmxl
KGludCBmZCwgc3RydWN0IHVzYl9lbmRwb2ludF9kZXNjcmlwdG9yKiBkZXNjKQp7CiAgcmV0
dXJuIGlvY3RsKGZkLCBVU0JfUkFXX0lPQ1RMX0VQX0VOQUJMRSwgZGVzYyk7Cn0KCnN0YXRp
YyBpbnQgdXNiX3Jhd19lcF9kaXNhYmxlKGludCBmZCwgaW50IGVwKQp7CiAgcmV0dXJuIGlv
Y3RsKGZkLCBVU0JfUkFXX0lPQ1RMX0VQX0RJU0FCTEUsIGVwKTsKfQoKc3RhdGljIGludCB1
c2JfcmF3X2NvbmZpZ3VyZShpbnQgZmQpCnsKICByZXR1cm4gaW9jdGwoZmQsIFVTQl9SQVdf
SU9DVExfQ09ORklHVVJFLCAwKTsKfQoKc3RhdGljIGludCB1c2JfcmF3X3ZidXNfZHJhdyhp
bnQgZmQsIHVpbnQzMl90IHBvd2VyKQp7CiAgcmV0dXJuIGlvY3RsKGZkLCBVU0JfUkFXX0lP
Q1RMX1ZCVVNfRFJBVywgcG93ZXIpOwp9CgpzdGF0aWMgaW50IHVzYl9yYXdfZXAwX3N0YWxs
KGludCBmZCkKewogIHJldHVybiBpb2N0bChmZCwgVVNCX1JBV19JT0NUTF9FUDBfU1RBTEws
IDApOwp9CgpzdGF0aWMgdm9pZCBzZXRfaW50ZXJmYWNlKGludCBmZCwgaW50IG4pCnsKICBz
dHJ1Y3QgdXNiX2RldmljZV9pbmRleCogaW5kZXggPSBsb29rdXBfdXNiX2luZGV4KGZkKTsK
ICBpZiAoIWluZGV4KQogICAgcmV0dXJuOwogIGlmIChpbmRleC0+aWZhY2VfY3VyID49IDAg
JiYgaW5kZXgtPmlmYWNlX2N1ciA8IGluZGV4LT5pZmFjZXNfbnVtKSB7CiAgICBmb3IgKGlu
dCBlcCA9IDA7IGVwIDwgaW5kZXgtPmlmYWNlc1tpbmRleC0+aWZhY2VfY3VyXS5lcHNfbnVt
OyBlcCsrKSB7CiAgICAgIGludCBydiA9IHVzYl9yYXdfZXBfZGlzYWJsZSgKICAgICAgICAg
IGZkLCBpbmRleC0+aWZhY2VzW2luZGV4LT5pZmFjZV9jdXJdLmVwc1tlcF0uaGFuZGxlKTsK
ICAgICAgaWYgKHJ2IDwgMCkgewogICAgICB9IGVsc2UgewogICAgICB9CiAgICB9CiAgfQog
IGlmIChuID49IDAgJiYgbiA8IGluZGV4LT5pZmFjZXNfbnVtKSB7CiAgICBmb3IgKGludCBl
cCA9IDA7IGVwIDwgaW5kZXgtPmlmYWNlc1tuXS5lcHNfbnVtOyBlcCsrKSB7CiAgICAgIGlu
dCBydiA9IHVzYl9yYXdfZXBfZW5hYmxlKGZkLCAmaW5kZXgtPmlmYWNlc1tuXS5lcHNbZXBd
LmRlc2MpOwogICAgICBpZiAocnYgPCAwKSB7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5k
ZXgtPmlmYWNlc1tuXS5lcHNbZXBdLmhhbmRsZSA9IHJ2OwogICAgICB9CiAgICB9CiAgICBp
bmRleC0+aWZhY2VfY3VyID0gbjsKICB9Cn0KCnN0YXRpYyBpbnQgY29uZmlndXJlX2Rldmlj
ZShpbnQgZmQpCnsKICBzdHJ1Y3QgdXNiX2RldmljZV9pbmRleCogaW5kZXggPSBsb29rdXBf
dXNiX2luZGV4KGZkKTsKICBpZiAoIWluZGV4KQogICAgcmV0dXJuIC0xOwogIGludCBydiA9
IHVzYl9yYXdfdmJ1c19kcmF3KGZkLCBpbmRleC0+Yk1heFBvd2VyKTsKICBpZiAocnYgPCAw
KSB7CiAgICByZXR1cm4gcnY7CiAgfQogIHJ2ID0gdXNiX3Jhd19jb25maWd1cmUoZmQpOwog
IGlmIChydiA8IDApIHsKICAgIHJldHVybiBydjsKICB9CiAgc2V0X2ludGVyZmFjZShmZCwg
MCk7CiAgcmV0dXJuIDA7Cn0KCiNkZWZpbmUgVVNCX01BWF9QQUNLRVRfU0laRSA0MDk2Cgpz
dHJ1Y3QgdXNiX3Jhd19jb250cm9sX2V2ZW50IHsKICBzdHJ1Y3QgdXNiX3Jhd19ldmVudCBp
bm5lcjsKICBzdHJ1Y3QgdXNiX2N0cmxyZXF1ZXN0IGN0cmw7CiAgY2hhciBkYXRhW1VTQl9N
QVhfUEFDS0VUX1NJWkVdOwp9OwoKc3RydWN0IHVzYl9yYXdfZXBfaW9fZGF0YSB7CiAgc3Ry
dWN0IHVzYl9yYXdfZXBfaW8gaW5uZXI7CiAgY2hhciBkYXRhW1VTQl9NQVhfUEFDS0VUX1NJ
WkVdOwp9OwoKc3RhdGljIHZvbGF0aWxlIGxvbmcKc3l6X3VzYl9jb25uZWN0X2ltcGwodWlu
dDY0X3Qgc3BlZWQsIHVpbnQ2NF90IGRldl9sZW4sIGNvbnN0IGNoYXIqIGRldiwKICAgICAg
ICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IHZ1c2JfY29ubmVjdF9kZXNjcmlwdG9ycyog
ZGVzY3MsCiAgICAgICAgICAgICAgICAgICAgIGxvb2t1cF9jb25uZWN0X291dF9yZXNwb25z
ZV90IGxvb2t1cF9jb25uZWN0X3Jlc3BvbnNlX291dCkKewogIGlmICghZGV2KSB7CiAgICBy
ZXR1cm4gLTE7CiAgfQogIGludCBmZCA9IHVzYl9yYXdfb3BlbigpOwogIGlmIChmZCA8IDAp
IHsKICAgIHJldHVybiBmZDsKICB9CiAgaWYgKGZkID49IE1BWF9GRFMpIHsKICAgIGNsb3Nl
KGZkKTsKICAgIHJldHVybiAtMTsKICB9CiAgc3RydWN0IHVzYl9kZXZpY2VfaW5kZXgqIGlu
ZGV4ID0gYWRkX3VzYl9pbmRleChmZCwgZGV2LCBkZXZfbGVuKTsKICBpZiAoIWluZGV4KSB7
CiAgICByZXR1cm4gLTE7CiAgfQogIGNoYXIgZGV2aWNlWzMyXTsKICBzcHJpbnRmKCZkZXZp
Y2VbMF0sICJkdW1teV91ZGMuJWxsdSIsIHByb2NpZCk7CiAgaW50IHJ2ID0gdXNiX3Jhd19p
bml0KGZkLCBzcGVlZCwgImR1bW15X3VkYyIsICZkZXZpY2VbMF0pOwogIGlmIChydiA8IDAp
IHsKICAgIHJldHVybiBydjsKICB9CiAgcnYgPSB1c2JfcmF3X3J1bihmZCk7CiAgaWYgKHJ2
IDwgMCkgewogICAgcmV0dXJuIHJ2OwogIH0KICBib29sIGRvbmUgPSBmYWxzZTsKICB3aGls
ZSAoIWRvbmUpIHsKICAgIHN0cnVjdCB1c2JfcmF3X2NvbnRyb2xfZXZlbnQgZXZlbnQ7CiAg
ICBldmVudC5pbm5lci50eXBlID0gMDsKICAgIGV2ZW50LmlubmVyLmxlbmd0aCA9IHNpemVv
ZihldmVudC5jdHJsKTsKICAgIHJ2ID0gdXNiX3Jhd19ldmVudF9mZXRjaChmZCwgKHN0cnVj
dCB1c2JfcmF3X2V2ZW50KikmZXZlbnQpOwogICAgaWYgKHJ2IDwgMCkgewogICAgICByZXR1
cm4gcnY7CiAgICB9CiAgICBpZiAoZXZlbnQuaW5uZXIudHlwZSAhPSBVU0JfUkFXX0VWRU5U
X0NPTlRST0wpCiAgICAgIGNvbnRpbnVlOwogICAgY2hhciogcmVzcG9uc2VfZGF0YSA9IE5V
TEw7CiAgICB1aW50MzJfdCByZXNwb25zZV9sZW5ndGggPSAwOwogICAgaWYgKGV2ZW50LmN0
cmwuYlJlcXVlc3RUeXBlICYgVVNCX0RJUl9JTikgewogICAgICBpZiAoIWxvb2t1cF9jb25u
ZWN0X3Jlc3BvbnNlX2luKGZkLCBkZXNjcywgJmV2ZW50LmN0cmwsICZyZXNwb25zZV9kYXRh
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZyZXNwb25zZV9sZW5n
dGgpKSB7CiAgICAgICAgdXNiX3Jhd19lcDBfc3RhbGwoZmQpOwogICAgICAgIGNvbnRpbnVl
OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoIWxvb2t1cF9jb25uZWN0X3Jlc3Bv
bnNlX291dChmZCwgZGVzY3MsICZldmVudC5jdHJsLCAmZG9uZSkpIHsKICAgICAgICB1c2Jf
cmF3X2VwMF9zdGFsbChmZCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcmVz
cG9uc2VfZGF0YSA9IE5VTEw7CiAgICAgIHJlc3BvbnNlX2xlbmd0aCA9IGV2ZW50LmN0cmwu
d0xlbmd0aDsKICAgIH0KICAgIGlmICgoZXZlbnQuY3RybC5iUmVxdWVzdFR5cGUgJiBVU0Jf
VFlQRV9NQVNLKSA9PSBVU0JfVFlQRV9TVEFOREFSRCAmJgogICAgICAgIGV2ZW50LmN0cmwu
YlJlcXVlc3QgPT0gVVNCX1JFUV9TRVRfQ09ORklHVVJBVElPTikgewogICAgICBydiA9IGNv
bmZpZ3VyZV9kZXZpY2UoZmQpOwogICAgICBpZiAocnYgPCAwKSB7CiAgICAgICAgcmV0dXJu
IHJ2OwogICAgICB9CiAgICB9CiAgICBzdHJ1Y3QgdXNiX3Jhd19lcF9pb19kYXRhIHJlc3Bv
bnNlOwogICAgcmVzcG9uc2UuaW5uZXIuZXAgPSAwOwogICAgcmVzcG9uc2UuaW5uZXIuZmxh
Z3MgPSAwOwogICAgaWYgKHJlc3BvbnNlX2xlbmd0aCA+IHNpemVvZihyZXNwb25zZS5kYXRh
KSkKICAgICAgcmVzcG9uc2VfbGVuZ3RoID0gMDsKICAgIGlmIChldmVudC5jdHJsLndMZW5n
dGggPCByZXNwb25zZV9sZW5ndGgpCiAgICAgIHJlc3BvbnNlX2xlbmd0aCA9IGV2ZW50LmN0
cmwud0xlbmd0aDsKICAgIHJlc3BvbnNlLmlubmVyLmxlbmd0aCA9IHJlc3BvbnNlX2xlbmd0
aDsKICAgIGlmIChyZXNwb25zZV9kYXRhKQogICAgICBtZW1jcHkoJnJlc3BvbnNlLmRhdGFb
MF0sIHJlc3BvbnNlX2RhdGEsIHJlc3BvbnNlX2xlbmd0aCk7CiAgICBlbHNlCiAgICAgIG1l
bXNldCgmcmVzcG9uc2UuZGF0YVswXSwgMCwgcmVzcG9uc2VfbGVuZ3RoKTsKICAgIGlmIChl
dmVudC5jdHJsLmJSZXF1ZXN0VHlwZSAmIFVTQl9ESVJfSU4pIHsKICAgICAgcnYgPSB1c2Jf
cmF3X2VwMF93cml0ZShmZCwgKHN0cnVjdCB1c2JfcmF3X2VwX2lvKikmcmVzcG9uc2UpOwog
ICAgfSBlbHNlIHsKICAgICAgcnYgPSB1c2JfcmF3X2VwMF9yZWFkKGZkLCAoc3RydWN0IHVz
Yl9yYXdfZXBfaW8qKSZyZXNwb25zZSk7CiAgICB9CiAgICBpZiAocnYgPCAwKSB7CiAgICAg
IHJldHVybiBydjsKICAgIH0KICB9CiAgc2xlZXBfbXMoMjAwKTsKICByZXR1cm4gZmQ7Cn0K
CnN0YXRpYyB2b2xhdGlsZSBsb25nIHN5el91c2JfY29ubmVjdCh2b2xhdGlsZSBsb25nIGEw
LCB2b2xhdGlsZSBsb25nIGExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdm9sYXRpbGUgbG9uZyBhMiwgdm9sYXRpbGUgbG9uZyBhMykKewogIHVpbnQ2NF90IHNw
ZWVkID0gYTA7CiAgdWludDY0X3QgZGV2X2xlbiA9IGExOwogIGNvbnN0IGNoYXIqIGRldiA9
IChjb25zdCBjaGFyKilhMjsKICBjb25zdCBzdHJ1Y3QgdnVzYl9jb25uZWN0X2Rlc2NyaXB0
b3JzKiBkZXNjcyA9CiAgICAgIChjb25zdCBzdHJ1Y3QgdnVzYl9jb25uZWN0X2Rlc2NyaXB0
b3JzKilhMzsKICByZXR1cm4gc3l6X3VzYl9jb25uZWN0X2ltcGwoc3BlZWQsIGRldl9sZW4s
IGRldiwgZGVzY3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZsb29rdXBfY29u
bmVjdF9yZXNwb25zZV9vdXRfZ2VuZXJpYyk7Cn0KCnN0YXRpYyB2b2lkIGtpbGxfYW5kX3dh
aXQoaW50IHBpZCwgaW50KiBzdGF0dXMpCnsKICBraWxsKC1waWQsIFNJR0tJTEwpOwogIGtp
bGwocGlkLCBTSUdLSUxMKTsKICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAg
ICBpZiAod2FpdHBpZCgtMSwgc3RhdHVzLCBXTk9IQU5HIHwgX19XQUxMKSA9PSBwaWQpCiAg
ICAgIHJldHVybjsKICAgIHVzbGVlcCgxMDAwKTsKICB9CiAgRElSKiBkaXIgPSBvcGVuZGly
KCIvc3lzL2ZzL2Z1c2UvY29ubmVjdGlvbnMiKTsKICBpZiAoZGlyKSB7CiAgICBmb3IgKDs7
KSB7CiAgICAgIHN0cnVjdCBkaXJlbnQqIGVudCA9IHJlYWRkaXIoZGlyKTsKICAgICAgaWYg
KCFlbnQpCiAgICAgICAgYnJlYWs7CiAgICAgIGlmIChzdHJjbXAoZW50LT5kX25hbWUsICIu
IikgPT0gMCB8fCBzdHJjbXAoZW50LT5kX25hbWUsICIuLiIpID09IDApCiAgICAgICAgY29u
dGludWU7CiAgICAgIGNoYXIgYWJvcnRbMzAwXTsKICAgICAgc25wcmludGYoYWJvcnQsIHNp
emVvZihhYm9ydCksICIvc3lzL2ZzL2Z1c2UvY29ubmVjdGlvbnMvJXMvYWJvcnQiLAogICAg
ICAgICAgICAgICBlbnQtPmRfbmFtZSk7CiAgICAgIGludCBmZCA9IG9wZW4oYWJvcnQsIE9f
V1JPTkxZKTsKICAgICAgaWYgKGZkID09IC0xKSB7CiAgICAgICAgY29udGludWU7CiAgICAg
IH0KICAgICAgaWYgKHdyaXRlKGZkLCBhYm9ydCwgMSkgPCAwKSB7CiAgICAgIH0KICAgICAg
Y2xvc2UoZmQpOwogICAgfQogICAgY2xvc2VkaXIoZGlyKTsKICB9IGVsc2UgewogIH0KICB3
aGlsZSAod2FpdHBpZCgtMSwgc3RhdHVzLCBfX1dBTEwpICE9IHBpZCkgewogIH0KfQoKc3Rh
dGljIHZvaWQgc2V0dXBfdGVzdCgpCnsKICBwcmN0bChQUl9TRVRfUERFQVRIU0lHLCBTSUdL
SUxMLCAwLCAwLCAwKTsKICBzZXRwZ3JwKCk7CiAgd3JpdGVfZmlsZSgiL3Byb2Mvc2VsZi9v
b21fc2NvcmVfYWRqIiwgIjEwMDAiKTsKfQoKc3RhdGljIHZvaWQgZXhlY3V0ZV9vbmUodm9p
ZCk7CgojZGVmaW5lIFdBSVRfRkxBR1MgX19XQUxMCgpzdGF0aWMgdm9pZCBsb29wKHZvaWQp
CnsKICBpbnQgaXRlciA9IDA7CiAgZm9yICg7OyBpdGVyKyspIHsKICAgIGludCBwaWQgPSBm
b3JrKCk7CiAgICBpZiAocGlkIDwgMCkKICAgICAgZXhpdCgxKTsKICAgIGlmIChwaWQgPT0g
MCkgewogICAgICBzZXR1cF90ZXN0KCk7CiAgICAgIGV4ZWN1dGVfb25lKCk7CiAgICAgIGV4
aXQoMCk7CiAgICB9CiAgICBpbnQgc3RhdHVzID0gMDsKICAgIHVpbnQ2NF90IHN0YXJ0ID0g
Y3VycmVudF90aW1lX21zKCk7CiAgICBmb3IgKDs7KSB7CiAgICAgIGlmICh3YWl0cGlkKC0x
LCAmc3RhdHVzLCBXTk9IQU5HIHwgV0FJVF9GTEFHUykgPT0gcGlkKQogICAgICAgIGJyZWFr
OwogICAgICBzbGVlcF9tcygxKTsKICAgICAgaWYgKGN1cnJlbnRfdGltZV9tcygpIC0gc3Rh
cnQgPCA1MDAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAga2lsbF9hbmRf
d2FpdChwaWQsICZzdGF0dXMpOwogICAgICBicmVhazsKICAgIH0KICB9Cn0KCnZvaWQgZXhl
Y3V0ZV9vbmUodm9pZCkKewogICoodWludDhfdCopMHgyMDAwMDA4MCA9IDB4MTI7CiAgKih1
aW50OF90KikweDIwMDAwMDgxID0gMTsKICAqKHVpbnQxNl90KikweDIwMDAwMDgyID0gMDsK
ICAqKHVpbnQ4X3QqKTB4MjAwMDAwODQgPSAweGI7CiAgKih1aW50OF90KikweDIwMDAwMDg1
ID0gMHgzNzsKICAqKHVpbnQ4X3QqKTB4MjAwMDAwODYgPSAweGY4OwogICoodWludDhfdCop
MHgyMDAwMDA4NyA9IDB4NDA7CiAgKih1aW50MTZfdCopMHgyMDAwMDA4OCA9IDB4MjA0MDsK
ICAqKHVpbnQxNl90KikweDIwMDAwMDhhID0gMHg4MjY1OwogICoodWludDE2X3QqKTB4MjAw
MDAwOGMgPSAweDJmODY7CiAgKih1aW50OF90KikweDIwMDAwMDhlID0gMDsKICAqKHVpbnQ4
X3QqKTB4MjAwMDAwOGYgPSAwOwogICoodWludDhfdCopMHgyMDAwMDA5MCA9IDA7CiAgKih1
aW50OF90KikweDIwMDAwMDkxID0gMTsKICAqKHVpbnQ4X3QqKTB4MjAwMDAwOTIgPSA5Owog
ICoodWludDhfdCopMHgyMDAwMDA5MyA9IDI7CiAgKih1aW50MTZfdCopMHgyMDAwMDA5NCA9
IDB4MWI7CiAgKih1aW50OF90KikweDIwMDAwMDk2ID0gMTsKICAqKHVpbnQ4X3QqKTB4MjAw
MDAwOTcgPSAwOwogICoodWludDhfdCopMHgyMDAwMDA5OCA9IDA7CiAgKih1aW50OF90Kikw
eDIwMDAwMDk5ID0gMDsKICAqKHVpbnQ4X3QqKTB4MjAwMDAwOWEgPSAwOwogICoodWludDhf
dCopMHgyMDAwMDA5YiA9IDk7CiAgKih1aW50OF90KikweDIwMDAwMDljID0gNDsKICAqKHVp
bnQ4X3QqKTB4MjAwMDAwOWQgPSAweDZjOwogICoodWludDhfdCopMHgyMDAwMDA5ZSA9IDA7
CiAgKih1aW50OF90KikweDIwMDAwMDlmID0gMTsKICAqKHVpbnQ4X3QqKTB4MjAwMDAwYTAg
PSAweGM0OwogICoodWludDhfdCopMHgyMDAwMDBhMSA9IDB4OGI7CiAgKih1aW50OF90Kikw
eDIwMDAwMGEyID0gMHhmODsKICAqKHVpbnQ4X3QqKTB4MjAwMDAwYTMgPSAwOwogICoodWlu
dDhfdCopMHgyMDAwMDBhNCA9IDc7CiAgKih1aW50OF90KikweDIwMDAwMGE1ID0gNTsKICAq
KHVpbnQ4X3QqKTB4MjAwMDAwYTYgPSAweDgzOwogICoodWludDhfdCopMHgyMDAwMDBhNyA9
IDB4ZDsKICAqKHVpbnQxNl90KikweDIwMDAwMGE4ID0gMDsKICAqKHVpbnQ4X3QqKTB4MjAw
MDAwYWEgPSAwOwogICoodWludDhfdCopMHgyMDAwMDBhYiA9IDA7CiAgKih1aW50OF90Kikw
eDIwMDAwMGFjID0gMDsKICBzeXpfdXNiX2Nvbm5lY3QoMCwgMHgyZCwgMHgyMDAwMDA4MCwg
MCk7Cn0KaW50IG1haW4odm9pZCkKewogIHN5c2NhbGwoX19OUl9tbWFwLCAweDFmZmZmMDAw
dWwsIDB4MTAwMHVsLCAwdWwsIDB4MzJ1bCwgLTEsIDB1bCk7CiAgc3lzY2FsbChfX05SX21t
YXAsIDB4MjAwMDAwMDB1bCwgMHgxMDAwMDAwdWwsIDd1bCwgMHgzMnVsLCAtMSwgMHVsKTsK
ICBzeXNjYWxsKF9fTlJfbW1hcCwgMHgyMTAwMDAwMHVsLCAweDEwMDB1bCwgMHVsLCAweDMy
dWwsIC0xLCAwdWwpOwogIGxvb3AoKTsKICByZXR1cm4gMDsKfQo=

--------------TPOrvoVVyvnDe0nsO0b2yJ7c--

